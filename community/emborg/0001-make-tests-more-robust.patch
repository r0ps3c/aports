From a8653dc45003ad3c303cfd5f1526c2c1b9c50f11 Mon Sep 17 00:00:00 2001
From: Ken Kundert <ken@theKunderts.net>
Date: Wed, 17 May 2023 09:55:14 -0700
Subject: [PATCH] make the tests more robust

---
 tests/test-cases.nt  | 8 ++++----
 tests/test_emborg.py | 7 ++++++-
 2 files changed, 10 insertions(+), 5 deletions(-)

diff --git a/tests/test-cases.nt b/tests/test-cases.nt
index 017a95f..92d46fb 100644
--- a/tests/test-cases.nt
+++ b/tests/test-cases.nt
@@ -591,10 +591,10 @@ emborg with configs:
     magnate:
         args: --quiet due
         expected:
-            > test0: (just now|(\d+ )?(seconds|minutes)) since last backup\.
-            > test1: (just now|(\d+ )?(seconds|minutes)) since last backup\.
-            > test2: (just now|(\d+ )?(seconds|minutes)) since last backup\.
-            > test3: (just now|(\d+ )?(seconds|minutes)) since last backup\.
+            > test0: (just now|(\d+(\.\d)? )?(seconds|minutes)) since last backup\.
+            > test1: (just now|(\d+(\.\d)? )?(seconds|minutes)) since last backup\.
+            > test2: (just now|(\d+(\.\d)? )?(seconds|minutes)) since last backup\.
+            > test3: (just now|(\d+(\.\d)? )?(seconds|minutes)) since last backup\.
         expected_type: regex
 
     build:
diff --git a/tests/test_emborg.py b/tests/test_emborg.py
index 07bd9df..f23521b 100755
--- a/tests/test_emborg.py
+++ b/tests/test_emborg.py
@@ -133,7 +133,12 @@ def run(self):
             if 'regex' in self.expected_type:
                 matches = bool(re.fullmatch(expected, result))
             else:
-                matches = expected == result
+                if 'error' in self.expected_type:
+                    # because error messages use wrapping the white space can
+                    # vary, so simply eliminate the white space
+                    matches = expected.split() == result.split()
+                else:
+                    matches = expected == result
 
         if matches and self.cmp_dirs:
             gen_dir, ref_dir = self.cmp_dirs
