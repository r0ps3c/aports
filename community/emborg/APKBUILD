# Contributor: Andy Hawkins <andy@gently.org.uk>
# Maintainer: Andy Hawkins <andy@gently.org.uk>
pkgname=emborg
pkgver=1.36
pkgrel=0
pkgdesc="Front-End to Borg Backup"
url="https://emborg.readthedocs.io/"
# armhf: borgbackup
arch="noarch !armhf"
license="GPL-3.0-or-later"
depends="
	borgbackup
	python3
	py3-appdirs
	py3-arrow>=0.15
	py3-docopt
	py3-inform>=1.28
	py3-quantiphy
	py3-requests
	"
makedepends="
	py3-flit-core
	py3-gpep517
	py3-installer
"
checkdepends="
	py3-pytest
	py3-nestedtext
	py3-parametrize-from-file
	py3-voluptuous
	"
subpackages="$pkgname-pyc"
# https://github.com/KenKundert/emborg/issues/71 - patch can be removed on next upgrade
source="https://github.com/KenKundert/emborg/archive/v$pkgver/emborg-v$pkgver.tar.gz
	0001-make-tests-more-robust.patch"

build() {
	gpep517 build-wheel \
		--wheel-dir dist \
		--output-fd 3 3>&1 >&2
}

check() {
	PYTHONPATH="$PWD/emborg" pytest --no-fuse
}

package() {
	python3 -m installer -d "$pkgdir" \
		dist/emborg-$pkgver*-py3-none-any.whl
}

sha512sums="
655c34202eb3f58cc30d6945ad128cc92043ffbe17d6de4ae867c0ea5f22c59309bef5eaea9faf35bfdbbe3f4a222b3b174b4e083266c7bb97e91c0c1831e983  emborg-v1.36.tar.gz
f8899909d670cfa56d441349a927c7ab0c45d9b3d98f342e305f42852f7731809b2addb807bb584c429d14b65a3421a92bf568ba73559107a646b1d23fdbc4f3  0001-make-tests-more-robust.patch
"
