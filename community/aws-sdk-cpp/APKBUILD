# Contributor: Holger Jaekel <holger.jaekel@gmx.de>
maintainer="Holger Jaekel <holger.jaekel@gmx.de>"
pkgname=aws-sdk-cpp
pkgver=1.11.600
pkgrel=0
pkgdesc="Amazon Web Services SDK for C++"
url="https://github.com/aws/aws-sdk-cpp"
# s390x: aws-c-common
# arm*, ppc64le: aws-crt-cpp
arch="all !armhf !armv7 !ppc64le !s390x"
license="Apache-2.0"
makedepends="
	aws-c-common-dev
	aws-crt-cpp-dev
	cmake
	curl-dev
	pulseaudio-dev
	python3-dev
	samurai
	"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/aws/aws-sdk-cpp/archive/refs/tags/$pkgver.tar.gz"
# check: tests are run in build step
options="!check"

_libs="
	AWSMigrationHub
	access-management
	accessanalyzer
	account
	acm-pca
	acm
	aiops
	amp
	amplify
	amplifybackend
	amplifyuibuilder
	apigateway
	apigatewaymanagementapi
	apigatewayv2
	appconfig
	appconfigdata
	appfabric
	appflow
	appintegrations
	application-autoscaling
	application-insights
	application-signals
	applicationcostprofiler
	appmesh
	apprunner
	appstream
	appsync
	apptest
	arc-zonal-shift
	artifact
	athena
	auditmanager
	autoscaling-plans
	autoscaling
	awstransfer
	b2bi
	backup-gateway
	backup
	backupsearch
	bedrock-agent-runtime
	bedrock-agent
	bedrock-runtime
	bedrock
	batch
	bcm-data-exports
	bcm-pricing-calculator
	bedrock-data-automation-runtime
	bedrock-data-automation
	billing
	billingconductor
	braket
	budgets
	ce
	chatbot
	chime-sdk-identity
	chime-sdk-media-pipelines
	chime-sdk-meetings
	chime-sdk-messaging
	chime-sdk-voice
	chime
	cleanrooms
	cleanroomsml
	cloud9
	cloudcontrol
	clouddirectory
	cloudformation
	cloudfront-keyvaluestore
	cloudfront
	cloudhsm
	cloudhsmv2
	cloudsearch
	cloudsearchdomain
	cloudtrail-data
	cloudtrail
	codeartifact
	codebuild
	codecatalyst
	codecommit
	codeconnections
	codedeploy
	codeguru-reviewer
	codeguru-security
	codeguruprofiler
	codepipeline
	codestar-connections
	codestar-notifications
	cognito-identity
	cognito-idp
	cognito-sync
	comprehend
	comprehendmedical
	compute-optimizer
	config
	connect-contact-lens
	connect
	connectcampaigns
	connectcampaignsv2
	connectcases
	connectparticipant
	controlcatalog
	controltower
	core
	cost-optimization-hub
	cur
	customer-profiles
	databrew
	dataexchange
	datapipeline
	datasync
	datazone
	dax
	deadline
	detective
	devicefarm
	devops-guru
	directconnect
	directory-service-data
	discovery
	dlm
	dms
	docdb-elastic
	docdb
	drs
	ds
	dsql
	dynamodb
	dynamodbstreams
	ebs
	ec2-instance-connect
	ec2
	ecr-public
	ecr
	ecs
	eks-auth
	eks
	elasticache
	elasticbeanstalk
	elasticfilesystem
	elasticloadbalancing
	elasticloadbalancingv2
	elasticmapreduce
	elastictranscoder
	email
	emr-containers
	emr-serverless
	entityresolution
	es
	eventbridge
	events
	evidently
	evs
	finspace-data
	finspace
	firehose
	fis
	fms
	forecast
	forecastquery
	frauddetector
	freetier
	fsx
	gamelift
	gameliftstreams
	geo-maps
	geo-places
	geo-routes
	glacier
	globalaccelerator
	glue
	grafana
	greengrass
	greengrassv2
	groundstation
	guardduty
	health
	healthlake
	iam
	identity-management
	identitystore
	imagebuilder
	importexport
	inspector2
	inspector-scan
	inspector
	internetmonitor
	invoicing
	iot-data
	iot-jobs-data
	iot-managed-integrations
	iot
	iot1click-devices
	iot1click-projects
	iotanalytics
	iotdeviceadvisor
	iotevents-data
	iotevents
	iotfleethub
	iotfleetwise
	iotsecuretunneling
	iotsitewise
	iotthingsgraph
	iottwinmaker
	iotwireless
	ivs-realtime
	ivs
	ivschat
	kafka
	kafkaconnect
	kendra-ranking
	kendra
	keyspacesstreams
	keyspaces
	kinesis-video-archived-media
	kinesis-video-media
	kinesis-video-signaling
	kinesis-video-webrtc-storage
	kinesis
	kinesisanalytics
	kinesisanalyticsv2
	kinesisvideo
	kms
	lakeformation
	lambda
	launch-wizard
	lex-models
	lex
	lexv2-models
	lexv2-runtime
	license-manager-linux-subscriptions
	license-manager-user-subscriptions
	license-manager
	lightsail
	location
	logs
	lookoutequipment
	lookoutmetrics
	lookoutvision
	m2
	machinelearning
	macie2
	mailmanager
	managedblockchain
	managedblockchain-query
	marketplace-agreement
	marketplace-catalog
	marketplace-deployment
	marketplace-entitlement
	marketplace-reporting
	marketplacecommerceanalytics
	mediaconnect
	mediaconvert
	medialive
	mediapackage-vod
	mediapackage
	mediapackagev2
	mediastore-data
	mediastore
	mediatailor
	medical-imaging
	memorydb
	meteringmarketplace
	mgn
	migration-hub-refactor-spaces
	migrationhub-config
	migrationhuborchestrator
	migrationhubstrategy
	monitoring
	mpa
	mq
	mturk-requester
	mwaa
	neptune-graph
	neptune
	neptunedata
	network-firewall
	networkflowmonitor
	networkmanager
	networkmonitor
	notifications
	notificationscontacts
	oam
	observabilityadmin
	odb
	omics
	opensearch
	opensearchserverless
	opsworks
	opsworkscm
	organizations
	osis
	outposts
	qbusiness
	qconnect
	partnercentral-selling
	pca-connector-ad
	pca-connector-scep
	pcs
	panorama
	payment-cryptography
	payment-cryptography-data
	personalize-events
	personalize-runtime
	personalize
	pi
	pinpoint-email
	pinpoint-sms-voice-v2
	pinpoint
	pipes
	polly
	pricing
	proton
	qapps
	qldb-session
	qldb
	queues
	quicksight
	ram
	rbin
	rds-data
	rds
	redshift-data
	redshift-serverless
	redshift
	rekognition
	repostspace
	resiliencehub
	resource-explorer-2
	resource-groups
	resourcegroupstaggingapi
	robomaker
	rolesanywhere
	route53-recovery-cluster
	route53-recovery-control-config
	route53-recovery-readiness
	route53
	route53domains
	route53resolver
	route53profiles
	rum
	s3-crt
	s3-encryption
	s3
	s3control
	s3outposts
	s3tables
	sagemaker-a2i-runtime
	sagemaker-edge
	sagemaker-featurestore-runtime
	sagemaker-geospatial
	sagemaker-metrics
	sagemaker-runtime
	sagemaker
	savingsplans
	scheduler
	schemas
	sdb
	secretsmanager
	security-ir
	securityhub
	securitylake
	serverlessrepo
	service-quotas
	servicecatalog-appregistry
	servicecatalog
	servicediscovery
	sesv2
	shield
	signer
	simspaceweaver
	sms-voice
	sms
	snow-device-management
	snowball
	sns
	socialmessaging
	sqs
	ssm-contacts
	ssm-incidents
	ssm-quicksetup
	ssm-sap
	ssm-guiconnect
	ssm
	sso-admin
	sso-oidc
	sso
	states
	storagegateway
	sts
	supplychain
	support-app
	support
	swf
	synthetics
	taxsettings
	text-to-speech
	textract
	timestream-influxdb
	timestream-query
	timestream-write
	tnb
	transcribe
	transcribestreaming
	transfer
	translate
	trustedadvisor
	verifiedpermissions
	voice-id
	vpc-lattice
	waf-regional
	waf
	wafv2
	wellarchitected
	wisdom
	workdocs
	worklink
	workmail
	workmailmessageflow
	workspaces-instances
	workspaces-thin-client
	workspaces-web
	workspaces
	xray
	"

for _lib in $_libs ; do
	subpackages="$subpackages $pkgname-$_lib:library"
done

prepare() {
	default_prepare

	find src/ generated/src/ -name "CMakeLists.txt" \
		-exec sh -c 'echo "set_target_properties(\${PROJECT_NAME} PROPERTIES VERSION \${PROJECT_VERSION} SOVERSION \${PROJECT_VERSION_MAJOR}.\${PROJECT_VERSION_MINOR})" >> "$1"' sh {} \;
}

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		local crossopts="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	CFLAGS="$CFLAGS -flto=auto" \
	CXXFLAGS="$CXXFLAGS -flto=auto -U_GLIBCXX_ASSERTIONS" \
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_MODULE_PATH=/usr/lib/cmake \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_TYPE=None \
		-DCUSTOM_MEMORY_MANAGEMENT=ON \
		-DBUILD_DEPS=OFF \
		-DENABLE_TESTING=ON \
		-DAUTORUN_UNIT_TESTS=ON \
		$crossopts
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
	rm -fv "$pkgdir"/usr/lib/libtesting-resources.so
}

library() {
	local name=${subpkgname#"$pkgname"-}
	pkgdesc="$pkgdesc ($name)"
	amove usr/lib/libaws-cpp-sdk-$name.so.*
}

sha512sums="
a8805e6a9a76ef2deb414b77dfff6ea5dbd85518fde41634af3b20e97f06a35780d1536c41a383a8c551d842a226a2be65a292ac945dbd5f249f0f455db85a56  aws-sdk-cpp-1.11.600.tar.gz
"
