Patch-Source: https://github.com/lsp-plugins/lsp-plugin-fw/commit/8e0bc50f2ec86393b94ffd89a8e53b8d89035040
--
From 8e0bc50f2ec86393b94ffd89a8e53b8d89035040 Mon Sep 17 00:00:00 2001
From: Vladimir Sadovnikov <sadko4u@gmail.com>
Date: Tue, 28 Mar 2023 23:00:33 +0300
Subject: [PATCH] Fixed build that disabled CairoCanvas for Inline Display
 feature

---
 CHANGELOG    |  2 +-
 src/Makefile | 63 ++++++++++++++++++++++++++--------------------------
 2 files changed, 33 insertions(+), 32 deletions(-)

diff --git a/src/Makefile b/src/Makefile
index 94d7e47..cf948aa 100644
--- a/modules/lsp-plugin-fw/src/Makefile
+++ b/modules/lsp-plugin-fw/src/Makefile
@@ -235,13 +235,13 @@ CXX_SRC                     = \
   $(CXX_SRC_DSP) \
   $(CXX_SRC_UI) \
   $(CXX_SRC_CTL) \
-  $(if $(findstring jack,$(ENABLED_FEATURES)),$(CXX_SRC_WRAP_JACK)) \
+  $(call fcheck,jack,$(ENABLED_FEATURES),$(CXX_SRC_WRAP_JACK)) \
   $(CXX_SRC_WRAP_LADSPA) \
-  $(if $(findstring lv2,$(ENABLED_FEATURES)),$(CXX_SRC_WRAP_LV2)) \
-  $(if $(findstring lv2,$(ENABLED_FEATURES)),$(CXX_SRC_WRAP_LV2_UI)) \
-  $(if $(findstring vst2,$(ENABLED_FEATURES)),$(CXX_SRC_WRAP_VST2)) \
-  $(if $(findstring clap,$(ENABLED_FEATURES)),$(CXX_SRC_WRAP_CLAP)) \
-  $(if $(CAIRO_VERSION),$(CXX_SRC_WRAP_CAIRO)) \
+  $(call fcheck,lv2,$(ENABLED_FEATURES),$(CXX_SRC_WRAP_LV2)) \
+  $(call fcheck,lv2,$(ENABLED_FEATURES),$(CXX_SRC_WRAP_LV2_UI)) \
+  $(call fcheck,vst2,$(ENABLED_FEATURES),$(CXX_SRC_WRAP_VST2)) \
+  $(call fcheck,clap,$(ENABLED_FEATURES),$(CXX_SRC_WRAP_CLAP)) \
+  $(if $(LIBCAIRO_VERSION),$(CXX_SRC_WRAP_CAIRO)) \
   $(CXX_SRC_UTIL)
 
 # Source code location for host
@@ -267,13 +267,13 @@ HOST_CXX_SRC                = \
   $(HOST_CXX_SRC_DSP) \
   $(HOST_CXX_SRC_UI) \
   $(HOST_CXX_SRC_CTL) \
-  $(if $(findstring jack,$(ENABLED_FEATURES)),$(HOST_CXX_SRC_WRAP_JACK)) \
+  $(call fcheck,jack,$(ENABLED_FEATURES),$(HOST_CXX_SRC_WRAP_JACK)) \
   $(HOST_CXX_SRC_WRAP_LADSPA) \
-  $(if $(findstring lv2,$(ENABLED_FEATURES)),$(HOST_CXX_SRC_WRAP_LV2)) \
-  $(if $(findstring lv2,$(ENABLED_FEATURES)),$(HOST_CXX_SRC_WRAP_LV2_UI)) \
-  $(if $(findstring vst2,$(ENABLED_FEATURES)),$(HOST_CXX_SRC_WRAP_VST2)) \
-  $(if $(findstring clap,$(ENABLED_FEATURES)),$(HOST_CXX_SRC_WRAP_CLAP)) \
-  $(if $(CAIRO_VERSION),$(HOST_CXX_SRC_WRAP_CAIRO)) \
+  $(call fcheck,lv2,$(ENABLED_FEATURES),$(HOST_CXX_SRC_WRAP_LV2)) \
+  $(call fcheck,lv2,$(ENABLED_FEATURES),$(HOST_CXX_SRC_WRAP_LV2_UI)) \
+  $(call fcheck,vst2,$(ENABLED_FEATURES),$(HOST_CXX_SRC_WRAP_VST2)) \
+  $(call fcheck,clap,$(ENABLED_FEATURES),$(HOST_CXX_SRC_WRAP_CLAP)) \
+  $(if $(LIBCAIRO_VERSION),$(HOST_CXX_SRC_WRAP_CAIRO)) \
   $(HOST_CXX_SRC_UTIL)
 
 # Object files for (cross) build
@@ -301,13 +301,13 @@ OBJ                         = \
   $(OBJ_UI) \
   $(OBJ_CTL) \
   $(OBJ_UTIL) \
-  $(if $(findstring jack,$(ENABLED_FEATURES)),$(OBJ_WRAP_JACK)) \
+  $(call fcheck,jack,$(ENABLED_FEATURES),$(OBJ_WRAP_JACK)) \
   $(OBJ_WRAP_LADSPA) \
-  $(if $(findstring lv2,$(ENABLED_FEATURES)),$(OBJ_WRAP_LV2)) \
-  $(if $(findstring lv2,$(ENABLED_FEATURES)),$(OBJ_WRAP_LV2_UI)) \
-  $(if $(findstring vst2,$(ENABLED_FEATURES)),$(OBJ_WRAP_VST2)) \
-  $(if $(findstring clap,$(ENABLED_FEATURES)),$(OBJ_WRAP_CLAP)) \
-  $(if $(CAIRO_VERSION),$(OBJ_WRAP_CAIRO))
+  $(call fcheck,lv2,$(ENABLED_FEATURES),$(OBJ_WRAP_LV2)) \
+  $(call fcheck,lv2,$(ENABLED_FEATURES),$(OBJ_WRAP_LV2_UI)) \
+  $(call fcheck,vst2,$(ENABLED_FEATURES),$(OBJ_WRAP_VST2)) \
+  $(call fcheck,clap,$(ENABLED_FEATURES),$(OBJ_WRAP_CLAP)) \
+  $(if $(LIBCAIRO_VERSION),$(OBJ_WRAP_CAIRO))
 
 # Object files for host build
 HOST_OBJ_STUB               = $(patsubst %.cpp, %.o, $(HOST_CXX_SRC_STUB))
@@ -334,13 +334,13 @@ HOST_OBJ                    = \
   $(HOST_OBJ_UI) \
   $(HOST_OBJ_CTL) \
   $(HOST_OBJ_UTIL) \
-  $(if $(findstring jack,$(ENABLED_FEATURES)),$(HOST_OBJ_WRAP_JACK)) \
+  $(call fcheck,jack,$(ENABLED_FEATURES),$(HOST_OBJ_WRAP_JACK)) \
   $(HOST_OBJ_WRAP_LADSPA) \
-  $(if $(findstring lv2,$(ENABLED_FEATURES)),$(HOST_OBJ_WRAP_LV2)) \
-  $(if $(findstring lv2,$(ENABLED_FEATURES)),$(HOST_OBJ_WRAP_LV2_UI)) \
-  $(if $(findstring vst2,$(ENABLED_FEATURES)),$(HOST_OBJ_WRAP_VST2)) \
-  $(if $(findstring clap,$(ENABLED_FEATURES)),$(HOST_OBJ_WRAP_CLAP)) \
-  $(if $(CAIRO_VERSION),$(HOST_OBJ_WRAP_CAIRO))
+  $(call fcheck,lv2,$(ENABLED_FEATURES),$(HOST_OBJ_WRAP_LV2)) \
+  $(call fcheck,lv2,$(ENABLED_FEATURES),$(HOST_OBJ_WRAP_LV2_UI)) \
+  $(call fcheck,vst2,$(ENABLED_FEATURES),$(HOST_OBJ_WRAP_VST2)) \
+  $(call fcheck,clap,$(ENABLED_FEATURES),$(HOST_OBJ_WRAP_CLAP)) \
+  $(if $(LIBCAIRO_VERSION),$(HOST_OBJ_WRAP_CAIRO))
 
 ifeq ($(TEST),1)
   CXX_SRC                    += $(CXX_SRC_TEST)
@@ -521,7 +521,7 @@ ARTIFACT_LIB_JACK_OBJS      = \
   $(LSP_PLUGIN_FW_OBJ_UI) \
   $(LSP_PLUGIN_FW_OBJ_CTL) \
   $(LSP_PLUGIN_FW_OBJ_RES) \
-  $(if $(CAIRO_VERSION),$(LSP_PLUGIN_FW_OBJ_WRAP_CAIRO)) \
+  $(if $(LIBCAIRO_VERSION),$(LSP_PLUGIN_FW_OBJ_WRAP_CAIRO)) \
   $(OBJ_EXPORT) \
   $(OBJ_PLUG_META) \
   $(OBJ_PLUG_DSP) \
@@ -554,7 +554,7 @@ ARTIFACT_LIB_LV2_OBJS       = \
   $(LSP_PLUGIN_FW_OBJ_META) \
   $(LSP_PLUGIN_FW_OBJ_DSP) \
   $(LSP_PLUGIN_FW_OBJ_RES) \
-  $(if $(CAIRO_VERSION),$(LSP_PLUGIN_FW_OBJ_WRAP_CAIRO)) \
+  $(if $(LIBCAIRO_VERSION),$(LSP_PLUGIN_FW_OBJ_WRAP_CAIRO)) \
   $(OBJ_PLUG_META) \
   $(OBJ_PLUG_DSP) \
   $(OBJ_PLUG_SHARED) \
@@ -632,16 +632,17 @@ ifeq ($(TEST),1)
     $(HOST_LSP_PLUGIN_FW_OBJ_CTL) \
     $(HOST_LSP_PLUGIN_FW_OBJ_RES) \
     $(HOST_LSP_PLUGIN_FW_OBJ_TEST) \
-    $(if $(CAIRO_VERSION),$(HOST_LSP_PLUGIN_FW_OBJ_WRAP_CAIRO)) \
+    $(if $(LIBCAIRO_VERSION),$(HOST_LSP_PLUGIN_FW_OBJ_WRAP_CAIRO)) \
     $(HOST_OBJ_PLUG_META) \
     $(HOST_OBJ_PLUG_DSP) \
     $(HOST_OBJ_PLUG_SHARED) \
     $(HOST_OBJ_PLUG_UI) \
-    $(if $(findstring jack,$(ENABLED_FEATURES)),$(HOST_OBJ_WRAP_JACK)) \
+    $(call fcheck,jack,$(ENABLED_FEATURES),$(HOST_OBJ_WRAP_JACK)) \
     $(HOST_OBJ_WRAP_LADSPA) \
-    $(if $(findstring lv2,$(ENABLED_FEATURES)),$(HOST_OBJ_WRAP_LV2)) \
-    $(if $(findstring lv2,$(ENABLED_FEATURES)),$(HOST_OBJ_WRAP_LV2UI)) \
-    $(if $(findstring vst2,$(ENABLED_FEATURES)),$(HOST_OBJ_WRAP_VST2)) \
+    $(call fcheck,lv2,$(ENABLED_FEATURES),$(HOST_OBJ_WRAP_LV2)) \
+    $(call fcheck,lv2,$(ENABLED_FEATURES),$(HOST_OBJ_WRAP_LV2UI)) \
+    $(call fcheck,vst2,$(ENABLED_FEATURES),$(HOST_OBJ_WRAP_VST2)) \
+    $(call fcheck,clap,$(ENABLED_FEATURES),$(HOST_OBJ_WRAP_CLAP)) \
     $(HOST_UTL_COMMON_OBJ) \
     $(HOST_UTL_VALIDATOR_OBJ) \
     $(HOST_UTL_JACK_MAKE_OBJ) \
