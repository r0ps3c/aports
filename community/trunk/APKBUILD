# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
# Maintainer: Matthias Ahouansou <matthias@ahouansou.cz>
pkgname=trunk
pkgver=0.21.4
pkgrel=0
pkgdesc="Build, bundle & ship your Rust WASM application to the web"
url="https://trunkrs.dev"
arch="all !s390x" # nix
license="MIT OR Apache-2.0"
makedepends="
	bzip2-dev
	cargo
	cargo-auditable
	openssl-dev
"
depends="
	rust
	wasm-bindgen
"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/trunk-rs/trunk/archive/refs/tags/v$pkgver.tar.gz
"
options="net"

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

check() {
	cargo test --frozen -- --skip tools::tests::download_and_install_binaries
}

package() {
	install -Dm 755 target/release/trunk "$pkgdir"/usr/bin/trunk

	for l in APACHE MIT
	do
		install -Dm 644 LICENSE-"$l" "$pkgdir"/usr/share/licenses/"$pkgname"/LICENSE-"$l"
	done
}

sha512sums="
4a4ca2f1e2ec098f7f8006d74524f45c1117fe93e8145d50eeba37801e07ffdf9d8e739164394824e43e6c3acb8b59f9756447a7118c2d9dc436cdb108e1b504  trunk-0.21.4.tar.gz
"
