# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=obs-studio
pkgver=29.1.0
pkgrel=0
pkgdesc="Free and open source software for live streaming and screen recording"
url="https://obsproject.com/"
arch="all !ppc64le !riscv64" # luajit
license="GPL-2.0-or-later"
options="!check"
makedepends="
	alsa-lib-dev
	cmake
	curl-dev
	eudev-dev
	ffmpeg-dev
	fontconfig-dev
	freetype-dev
	jack-dev
	jansson-dev
	librist-dev
	libsrt-dev
	libva-glx-dev
	libx11-dev
	libxcomposite-dev
	libxinerama-dev
	libxkbcommon-dev
	luajit-dev
	mbedtls-dev
	mesa-dev
	pciutils-dev
	pipewire-dev
	pulseaudio-dev
	python3-dev
	qt6-qtbase-dev
	qt6-qtsvg-dev
	samurai
	sndio-dev
	speexdsp-dev
	swig
	v4l-utils-dev
	wayland-dev
	x264-dev
	"
subpackages="$pkgname-dev"
source="https://github.com/obsproject/obs-studio/archive/$pkgver/obs-studio-$pkgver.tar.gz
	broken-config.patch
	disable-some-plugins.patch
	no-glvnd.patch
	no-werror.patch
	"

# armhf, s390x have no vlc
case $CARCH in
	armhf|s390x)
		_vlc=OFF
		;;
	*)
		makedepends="$makedepends vlc-dev"
		_vlc=ON
		;;
esac

build() {
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_SKIP_INSTALL_RPATH=ON \
		-DOBS_VERSION_OVERRIDE=$pkgver \
		-DENABLE_JACK=ON \
		-DENABLE_VLC=$_vlc
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
39978eb1872d8fc3903db654b0f227f9ff6d66283261f4a5d736b3404ab9549708c468f18f98402ad3e2759ed3e937b56a4fb4eae600bd226cf6b3e7dafe6b0d  obs-studio-29.1.0.tar.gz
b692082e7d21ccc8fc15e839821bba7b9692925a50cac7cca2769dae2592254d5ee29057b52d60d666896924e322d8b36b4a2e61446e957d3c146f032fe8cae3  broken-config.patch
91ab3f9f59ed06d77375aa1e1834e4e35d2f6f1de47b202038eb9cc1579cc73749a66e1cbc9323d8be95b3fd812798fe4797b8eba57927301b89f469edc4a987  disable-some-plugins.patch
b462fd7299da4d159e69130adcfcdb49c776c092419bb2cafe3c4520d122161c11137765022494f8450693f323f34082fe95674a9ee17394ca3939004847e418  no-glvnd.patch
cc582c45d85928fb400418df03b6121654cfcca206aa8c636909f0d0141b14749e8fbbb96320fbdec27b042582a96cbffd332eda685f88d28bda602d439e3d1f  no-werror.patch
"
