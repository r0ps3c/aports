Patch-Source: https://github.com/12101111/overlay/blob/32a0d72fe1c226885033a77d2802c0cf34a46a36/dev-lang/deno/files/bindgen_macro_fix.patch
Patch-Source: https://github.com/12101111/overlay/blob/32a0d72fe1c226885033a77d2802c0cf34a46a36/dev-lang/deno/files/bindgen_macro_fix2.patch

--- a/vendor/v8/build.rs
+++ b/vendor/v8/build.rs
@@ -153,6 +153,7 @@ fn build_binding() {
     .parse_callbacks(Box::new(bindgen::CargoCallbacks::new()))
     .clang_args(["-x", "c++", "-std=c++20", "-Iv8/include", "-I."])
     .clang_args(args)
+    .clang_macro_fallback()
     .generate_cstr(true)
     .rustified_enum(".*UseCounterFeature")
     .allowlist_item("v8__.*")
--- a/vendor/v8/Cargo.lock
+++ b/vendor/v8/Cargo.lock
@@ -1,6 +1,6 @@
 # This file is automatically @generated by Cargo.
 # It is not intended for manual editing.
-version = 3
+version = 4
 
 [[package]]
 name = "adler"
@@ -25,16 +25,14 @@ checksum = "1926655ba000b19e21f0402be09a1d52d318c8a8a68622870bfb7af2a71315cd"
 
 [[package]]
 name = "bindgen"
-version = "0.69.4"
+version = "0.70.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "a00dc851838a2120612785d195287475a3ac45514741da670b735818822129a0"
+checksum = "f49d8fed880d473ea71efb9bf597651e77201bdd4893efe54c9e5d65ae04ce6f"
 dependencies = [
  "bitflags",
  "cexpr",
  "clang-sys",
  "itertools",
- "lazy_static",
- "lazycell",
  "log",
  "prettyplease",
  "proc-macro2",
@@ -43,7 +41,6 @@ dependencies = [
  "rustc-hash",
  "shlex",
  "syn",
- "which 4.4.2",
 ]
 
 [[package]]
@@ -180,18 +177,6 @@ version = "1.0.11"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "49f1f14873335454500d59611f1cf4a4b0f786f9ac11f4312a78e4cf2566695b"
 
-[[package]]
-name = "lazy_static"
-version = "1.4.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "e2abad23fbc42b3700f2f279844dc832adb2b2eb069b2df918f455c4e18cc646"
-
-[[package]]
-name = "lazycell"
-version = "1.3.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "830d08ce1d1d941e6b30645f1a0eb5643013d835ce3779a5fc208261dbe10f55"
-
 [[package]]
 name = "libc"
 version = "0.2.153"
@@ -487,19 +472,7 @@ dependencies = [
  "paste",
  "rustversion",
  "trybuild",
- "which 6.0.1",
-]
-
-[[package]]
-name = "which"
-version = "4.4.2"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "87ba24419a2078cd2b0f2ede2691b6c66d8e47836da3b6db8265ebad47afbfc7"
-dependencies = [
- "either",
- "home",
- "once_cell",
- "rustix",
+ "which",
 ]
 
 [[package]]
--- a/vendor/v8/Cargo.toml
+++ b/vendor/v8/Cargo.toml
@@ -174,7 +174,7 @@ version = "1.0"
 version = "0.1.0"
 
 [dev-dependencies.bindgen]
-version = "0.69"
+version = "0.70"
 
 [dev-dependencies.bytes]
 version = "1"
@@ -201,7 +201,7 @@ version = "1.0.96"
 version = "6"
 
 [build-dependencies.bindgen]
-version = "0.69"
+version = "0.70"
 
 [build-dependencies.fslock]
 version = "0.2"
