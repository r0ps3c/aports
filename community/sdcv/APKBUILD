# Contributor: Sodface <sod@sodface.com>
# Maintainer: Sodface <sod@sodface.com>
pkgname=sdcv
pkgver=0.5.4
pkgrel=0
pkgdesc="Console version of StarDict"
url="https://dushistov.github.io/sdcv/"
license="GPL-2.0-or-later"
arch="all"
makedepends="cmake glib-dev readline-dev samurai zlib-dev"
checkdepends="jq"
subpackages="$pkgname-doc $pkgname-lang"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/Dushistov/sdcv/archive/v$pkgver.tar.gz
	01-0.5.4-off_t.patch
	02-0.5.4-bookname_to_ifo.patch
	03-0.5.4-dict.patch
	"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=None \
		-DBUILD_TESTS=True \
		$CMAKE_CROSSOPTS
	cmake --build build
}

check() {
	cd build
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	mkdir build/locale
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
6bae3a2c0f37ed9380f54715626efeea0df75d2525baa583c0915bba4d082d9ece40ee799a1e1bb5d36b7ccebace853653b6fab57d472a432b910f690235ee21  sdcv-0.5.4.tar.gz
f533f456ee4691f9e816e05f5e6d553fbf09509765aba2744ffc746ec08564575bbfa15d12c84d244940da2e0f2cfef2571cf85d5fa8a36bc958cac2e967fc36  01-0.5.4-off_t.patch
273d58b9358890332d18e44474038e87dcaed4cde6569d240da765c1ae71f43f57409cdc5537e0f6ba958ddf1b51ecab7e59e8c35015d7ac241d045504dd4fb0  02-0.5.4-bookname_to_ifo.patch
1099acd7aadd0cae3943fe3ecf9535980abf52839a987b13260a2b5196429f5956c939ca5a2ecc1bc06d3627dee42548a1b7e4c5d1005ab4e2fb47507e93fae2  03-0.5.4-dict.patch
"
