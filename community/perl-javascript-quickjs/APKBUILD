# Automatically generated by apkbuild-cpan, template 3
# Contributor: Celeste <cielesti@protonmail.com>
# Maintainer: Celeste <cielesti@protonmail.com>
pkgname=perl-javascript-quickjs
#_pkgreal is used by apkbuild-cpan to find modules at MetaCpan
_pkgreal=JavaScript-QuickJS
pkgver=0.19
pkgrel=0
pkgdesc="Run JavaScript via QuickJS in Perl"
url="https://metacpan.org/release/JavaScript-QuickJS/"
arch="all !s390x !ppc64le" # quickjs
license="GPL-1.0-or-later OR Artistic-1.0-Perl"
depends="
	perl
	perl-types-serialiser
	"
makedepends="
	perl-dev
	perl-extutils-makemaker-cpanfile
	perl-file-slurper
	perl-file-which
	quickjs-dev
	"
checkdepends="
	perl-test-deep
	perl-test-failwarnings
	perl-test-fatal
	"
subpackages="$pkgname-doc"
source="https://cpan.metacpan.org/authors/id/F/FE/FELIPE/JavaScript-QuickJS-$pkgver.tar.gz
	quickjs-shared.mk.pl
	"
builddir="$srcdir/$_pkgreal-$pkgver"

prepare() {
	default_prepare

	cp -v ../quickjs-shared.mk.pl Makefile.PL
}

build() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	PERL_MM_USE_DEFAULT=1 perl -I. Makefile.PL INSTALLDIRS=vendor
	make
}

check() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	make test
}

package() {
	make DESTDIR="$pkgdir" install
	find "$pkgdir" \( -name perllocal.pod -o -name .packlist \) -delete
}

sha512sums="
808a08cbfaa4eaf4179e89aae12f269311519dc74dd5f7ceba3ae0ac756df77004f66d45f485eeb161c9d32c30e9146960712f6afc0c49b08c491a8ca7630024  JavaScript-QuickJS-0.19.tar.gz
79a52978a133934dfdfb7d4f9d30b3b4649d13ff89a4d3e425cc904af0bbdcd3fd85564d17c29f7f3e8b4f38c0ad4965b4a2669aa09a097b64d74c82ed842590  quickjs-shared.mk.pl
"
