# Automatically generated by apkbuild-cpan, template 3
# Contributor: Celeste <cielesti@protonmail.com>
# Maintainer: Celeste <cielesti@protonmail.com>
pkgname=perl-javascript-quickjs
#_pkgreal is used by apkbuild-cpan to find modules at MetaCpan
_pkgreal=JavaScript-QuickJS
pkgver=0.18
pkgrel=0
pkgdesc="Run JavaScript via QuickJS in Perl"
url="https://metacpan.org/release/JavaScript-QuickJS/"
arch="all !s390x !ppc64le" # quickjs
license="GPL-1.0-or-later OR Artistic-1.0-Perl"
depends="
	perl
	perl-types-serialiser
	"
makedepends="
	perl-dev
	perl-extutils-makemaker-cpanfile
	perl-file-slurper
	perl-file-which
	quickjs-dev
	"
checkdepends="
	perl-test-deep
	perl-test-failwarnings
	perl-test-fatal
	"
subpackages="$pkgname-doc"
source="https://cpan.metacpan.org/authors/id/F/FE/FELIPE/JavaScript-QuickJS-$pkgver.tar.gz
	quickjs-shared.mk.pl
	"
builddir="$srcdir/$_pkgreal-$pkgver"

prepare() {
	default_prepare

	cp -v ../quickjs-shared.mk.pl Makefile.PL
}

build() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	PERL_MM_USE_DEFAULT=1 perl -I. Makefile.PL INSTALLDIRS=vendor
	make
}

check() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	make test
}

package() {
	make DESTDIR="$pkgdir" install
	find "$pkgdir" \( -name perllocal.pod -o -name .packlist \) -delete
}

sha512sums="
39e1303a2bd2839196cf2a3d48ab1f5fd0c54e5a7a949411a6cedf9fbee12d62e6feafe83977982e518da2c59e450f850572d5bd507eea35e371459e8de4b3bc  JavaScript-QuickJS-0.18.tar.gz
79a52978a133934dfdfb7d4f9d30b3b4649d13ff89a4d3e425cc904af0bbdcd3fd85564d17c29f7f3e8b4f38c0ad4965b4a2669aa09a097b64d74c82ed842590  quickjs-shared.mk.pl
"
