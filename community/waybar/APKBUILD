# Contributor: Luca Weiss <luca@z3ntu.xyz>
# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=waybar
pkgver=0.9.19
pkgrel=2
pkgdesc="Highly customizable Wayland bar for Sway and Wlroots based compositors"
url="https://github.com/Alexays/Waybar/"
# s390x: no wireplumber (but who uses it there anyway)
arch="all !s390x"
license="MIT"
depends="tzdata"
makedepends="
	date-dev
	eudev-dev
	fmt-dev
	gtk-layer-shell-dev
	gtkmm3-dev
	jsoncpp-dev
	libdbusmenu-gtk3-dev
	libinput-dev
	libmpdclient-dev
	libnl3-dev
	meson
	playerctl-dev
	pulseaudio-dev
	scdoc
	spdlog-dev
	sndio-dev
	wireplumber-dev
	"
subpackages="$pkgname-doc"
source="https://github.com/Alexays/Waybar/archive/$pkgver/Waybar-$pkgver.tar.gz
	$pkgname-fix-resume.patch::https://github.com/Alexays/Waybar/commit/f62b3d0e9dba3847e8029bdbc2fb71ecacc7c667.diff
	config-fix-clock.patch
	"
options="!check" # No test suite
builddir="$srcdir/Waybar-$pkgver"

build() {
	# -Ddefault_library=shared - to override the project defaults.
	abuild-meson \
		-Ddefault_library=shared \
		-Ddbusmenu-gtk=enabled \
		-Dgtk-layer-shell=enabled \
		-Dlibevdev=disabled \
		-Dlibnl=enabled \
		-Dlibudev=enabled \
		-Dman-pages=enabled \
		-Dmpd=enabled \
		-Dmpris=enabled \
		-Dpulseaudio=enabled \
		-Drfkill=enabled \
		-Dsndio=enabled \
		-Dsystemd=disabled \
		-Dwireplumber=enabled \
		. output
	meson compile -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

sha512sums="
32120bcf39b3b16d44a42e9121645e6d28c34b73dc54d30f4dcb40cb600865e3948fc839fde2f30c956e58627f7bef7f5e93a537223ca03350a016c77dde70c7  Waybar-0.9.19.tar.gz
b1073004380dda8cf51e149833d5a8ceccf504e4368bddee74ebd3d69ee3bf31c84258b343c27c68d976ff834456976d46b4697eb972ea664491139b6fb7ad38  waybar-fix-resume.patch
173857d836630925658af5d1c1aa3630fe91d08a8bad09a63d724fd6dc622fc063a9bc936008dfe776573a263f1a90ad9d9f3e11eba6930448dc0a132e106af2  config-fix-clock.patch
"
