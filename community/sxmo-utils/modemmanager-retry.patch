Author: Anjandev Momi <anjan@momi.ca>
URL: https://lists.sr.ht/~mil/sxmo-devel/patches/41607
Summary: Fixes double text on SDM845 devices
----
--- a/scripts/modem/sxmo_modem.sh
+++ b/scripts/modem/sxmo_modem.sh
@@ -242,7 +242,18 @@ checkfornewtexts() {
 		stderr "Text from number: $NUM (TEXTID: $TEXTID)"
 		sxmo_hook_smslog.sh "recv" "$NUM" "$NUM" "$TIME" "$TEXT" >> "$SXMO_LOGDIR/$NUM/sms.txt"
 		printf %b "$TIME\trecv_txt\t$NUM\t${#TEXT} chars\n" >> "$SXMO_LOGDIR/modemlog.tsv"
-		mmcli -m any --messaging-delete-sms="$TEXTID"
+
+		tries=1
+		while ! mmcli -m any --messaging-delete-sms="$TEXTID";
+		do
+			if [ $tries -gt 5 ];
+			then
+				break
+			fi
+			echo "Failed to delete text $TEXTID. Will retry"
+			sleep 3
+			tries=$((tries+1))
+		done
 		CONTACTNAME=$(sxmo_contacts.sh --name-or-number "$NUM")
 
 		if [ -z "$SXMO_DISABLE_SMS_NOTIFS" ]; then
-- 
2.40.1


