From 227c72a125291ed8d04ad991f2496620c0fc341b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Guido=20G=C3=BCnther?= <agx@sigxcpu.org>
Date: Fri, 18 Aug 2023 17:12:05 +0200
Subject: [PATCH] data: Add portals default config
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

We keep the `UseIn` in phosh.portal for the moment to support
older xdg-desktop-portal.

Thanks: Pablo Correa Gomez for bringing this up
Closes: https://gitlab.gnome.org/World/Phosh/phosh/-/issues/979
Signed-off-by: Guido GÃ¼nther <agx@sigxcpu.org>
---
 data/meson.build        | 2 +-
 data/phosh-portals.conf | 4 ++++
 debian/phosh.install    | 1 +
 meson.build             | 6 ++++++
 4 files changed, 12 insertions(+), 1 deletion(-)
 create mode 100644 data/phosh-portals.conf

diff --git a/data/meson.build b/data/meson.build
index fa5c7c016..9898ae6b5 100644
--- a/data/meson.build
+++ b/data/meson.build
@@ -142,4 +142,4 @@ install_data('wayland-sessions/phosh.desktop',
 	     install_dir : 'share/wayland-sessions')
 
 install_data('phosh.portal', install_dir : join_paths(datadir, 'xdg-desktop-portal', 'portals'))
-
+install_data('phosh-portals.conf', install_dir : join_paths(sysconfdir, 'xdg-desktop-portal'))
diff --git a/data/phosh-portals.conf b/data/phosh-portals.conf
new file mode 100644
index 000000000..1b2f76b26
--- /dev/null
+++ b/data/phosh-portals.conf
@@ -0,0 +1,4 @@
+[preferred]
+default=gtk
+org.freedesktop.impl.portal.Access=phosh
+org.freedesktop.impl.portal.ScreenCast=wlr
diff --git a/debian/phosh.install b/debian/phosh.install
index a6dde391a..c418e7c29 100644
--- a/debian/phosh.install
+++ b/debian/phosh.install
@@ -1,3 +1,4 @@
+etc/xdg-desktop-portal/phosh-portals.conf
 usr/bin/phosh-session
 usr/lib/systemd/user/
 usr/libexec/phosh
diff --git a/meson.build b/meson.build
index 58179f8db..2ba6a5b2b 100644
--- a/meson.build
+++ b/meson.build
@@ -23,6 +23,12 @@ plugin_prefs_dir = join_paths(prefix, libdir, 'phosh', 'plugins', 'prefs')
 servicedir = join_paths(datadir, 'dbus-1', 'services')
 schemasdir = datadir / 'glib-2.0/schemas'
 
+if prefix != '/usr'
+  sysconfdir = join_paths(prefix, get_option('sysconfdir'))
+else
+  sysconfdir = get_option('sysconfdir')
+endif
+
 glib_ver = 'GLIB_VERSION_2_72'
 
 add_project_arguments([
-- 
GitLab

