# Maintainer: Thomas Liske <thomas@fiasko-nw.net>
pkgname=birdwatcher
pkgver=2.2.5
pkgrel=3
pkgdesc="A JSON API for BIRD"
url="https://github.com/alice-lg/birdwatcher"
arch="all"
license="BSD-3-Clause"
makedepends="go"
options="net"
source="birdwatcher-$pkgver.tar.gz::https://github.com/alice-lg/birdwatcher/archive/refs/tags/$pkgver.tar.gz
	birdwatcher.initd
	birdwatcher.pre-install
	"
subpackages="$pkgname-openrc"

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

build() {
	go build -o birdwatcher
}

check() {
	go test -v
}

package() {
	install -Dm755 birdwatcher "$pkgdir"/usr/bin/birdwatcher
	install -Dm644 etc/birdwatcher/birdwatcher.conf "$pkgdir"/etc/birdwatcher/birdwatcher.conf
	install -Dm755 "$srcdir"/birdwatcher.initd "$pkgdir"/etc/init.d/birdwatcher
}

sha512sums="
1e0292635b5eedb987ed0da2f077f94730039274bc194c5686246c83fbd329f59809ffb55d32fe1810fd06d69f86a648daf7facecb93aba572b6e12a1cc4440e  birdwatcher-2.2.5.tar.gz
867fab10867eaedddf158c3d60704fdec4395f5f7bc20a67d3c74ae7acbcfc02c33456b5da48c81d0ba6678c0c87769cc2bfc1b8c530dae1697abab9d98be332  birdwatcher.initd
7650a0fb04c7924f0eb98b985aedee19a84ff2a46229d6b9f51be11db1fc4523c9d00776ea5cfeec2ea9fe1e2a30c91247b63d529fdf987fa4fcbc3c4eed27cd  birdwatcher.pre-install
"
