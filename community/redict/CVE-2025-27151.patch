Patch-Source: https://codeberg.org/redict/redict/pulls/91
---
From 40aa98db1d6601d30154ff078705dcfe1c4c7708 Mon Sep 17 00:00:00 2001
From: fossdd <fossdd@pwned.life>
Date: Wed, 28 May 2025 18:52:50 +0200
Subject: [PATCH] Check length of AOF file name in redict-check-aof
 (CVE-2025-27151)

Ensure that the length of the input file name does not exceed PATH_MAX

Co-Authored-By: YaacovHazan <yaacov.hazan@redis.com>
Patch-Source: https://github.com/redis/redis/commit/643b5db235cb82508e72f11c7b4bbfc7dc39be56
---
 src/redict-check-aof.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/redict-check-aof.c b/src/redict-check-aof.c
index 0266cc70e..377168cdc 100644
--- a/src/redict-check-aof.c
+++ b/src/redict-check-aof.c
@@ -534,6 +534,12 @@ int redict_check_aof_main(int argc, char **argv) {
         goto invalid_args;
     }
 
+    /* Check if filepath is longer than PATH_MAX */
+    if (strlen(filepath) > PATH_MAX) {
+        printf("Error: filepath is too long (exceeds PATH_MAX)\n");
+        goto invalid_args;
+    }
+
     /* In the glibc implementation dirname may modify their argument. */
     memcpy(temp_filepath, filepath, strlen(filepath) + 1);
     dirpath = dirname(temp_filepath);
-- 
2.45.2

