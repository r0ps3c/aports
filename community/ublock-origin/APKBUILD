# Contributor: Hugo Osvaldo Barrera <hugo@whynothugo.nl>
maintainer="Hugo Osvaldo Barrera <hugo@whynothugo.nl>"
pkgname=ublock-origin
pkgver=1.63.0
pkgrel=0
pkgdesc="Efficient blocker add-on for Firefox"
url="https://github.com/gorhill/uBlock"
arch="noarch"
license="GPL-3.0-or-later"
makedepends="git python3 zip bash strip-nondeterminism"
# Upstream's build script pulls latest master for uAssets.
# Pin the versions we use so we don't need network at built-time and the package
# sources are deterministic.
_uassets_master=10c162434232f4e7bf7c575878ad9bd7ba3d53a8
_uassets_ghpages=264bc34f0ee5076f361371dbf362bdeb5d28a158
source="ublock-origin-$pkgver.tar.gz::https://github.com/gorhill/uBlock/archive/refs/tags/$pkgver.tar.gz
	uAssets-$_uassets_master.tar.gz::https://github.com/uBlockOrigin/uAssets/archive/$_uassets_master.tar.gz
	uAssets-$_uassets_ghpages.tar.gz::https://github.com/uBlockOrigin/uAssets/archive/$_uassets_ghpages.tar.gz
"
builddir="$srcdir/uBlock-$pkgver"
options="!check" # no tests

prepare() {
	default_prepare

	mkdir -p dist/build/uAssets
	mv ../uAssets-$_uassets_master dist/build/uAssets/main
	mv ../uAssets-$_uassets_ghpages dist/build/uAssets/prod
}

build() {
	make firefox
	strip-nondeterminism -t zip -T "$SOURCE_DATE_EPOCH" dist/build/uBlock0.firefox.xpi
}

package() {
	install -Dm644 dist/build/uBlock0.firefox.xpi "$pkgdir/usr/lib/firefox/browser/extensions/uBlock0@raymondhill.net.xpi"
}

sha512sums="
02e38d0ee679a747a6eac0c492352e35d75d3cc06fcb0ca90e65a73a450a2643f4dc20745c8a8cdd8ee41de0e0de697b16dd366037f868c4a807d029186d10d6  ublock-origin-1.63.0.tar.gz
c90ca228141ce8be32e9d6b5234305154a0a621b9302f85b00bfda639a8473fb0db73c8ef0ba3eedc87e93c0e962a8d6a42ac2d1af001b71277799f5dd5971f0  uAssets-10c162434232f4e7bf7c575878ad9bd7ba3d53a8.tar.gz
8cc8886c7e4264566a35ecca7bc6783175cddeb20946ce5811a7cc0f9290e6e50b74bebbc38785b2a352bed319ce09456e2d5711a834f36350dc20c477700aa3  uAssets-264bc34f0ee5076f361371dbf362bdeb5d28a158.tar.gz
"
