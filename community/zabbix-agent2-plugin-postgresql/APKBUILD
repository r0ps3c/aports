# Maintainer: Leonardo Arena <rnalrd@alpinelinux.org>
pkgname=zabbix-agent2-plugin-postgresql
pkgver=6.4.9
pkgrel=0
pkgdesc="Zabbix Agent 2 PostgreSQL loadable plugin"
url="https://git.zabbix.com/projects/AP/repos/postgresql/browse"
arch="all"
license="Apache-2.0"
makedepends="go gettext-dev"
subpackages=""
source="https://cdn.zabbix.com/zabbix-agent2-plugins/sources/postgresql/$pkgname-$pkgver.tar.gz
	0001-set-plugin-system-path.patch
	"

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

build() {
	export CGO_LDFLAGS="$LDFLAGS -s -w"
	make
}

package() {
	install -D -m644 postgresql.conf \
		"$pkgdir"/etc/zabbix/zabbix_agent2.d/plugins.d/postgresql.conf
	install -D -m755 zabbix-agent2-plugin-postgresql \
		"$pkgdir"/usr/libexec/zabbix-agent2/postgresql
}

check() {
	make check
}

sha512sums="
8fc06a71d8b91d8625af36581c6d21457a53c3d7fda6facbbad13caab386910b120ef46e4e2e8072b98b7ac20555ce6afa170360a989ab2d504cfd8bf8e4df8e  zabbix-agent2-plugin-postgresql-6.4.9.tar.gz
a63a2a20e78c8349b1a8d08470d89b5feb73cf2483bec9069a2b159151e46d69f510541a9a624153ffb2a002fff0684e3fd2559f256f4073790e88304e991f59  0001-set-plugin-system-path.patch
"
