Patch-Source: https://github.com/archlinux/svntogit-community/blob/a7f15313fbf1bd4434b6b0a05cf87ec36047ed52/trunk/build-ac.index-in-tmp.diff
diff --git a/backends/pep517.py b/backends/pep517.py
index 4e48180..933dfe8 100644
--- a/backends/pep517.py
+++ b/backends/pep517.py
@@ -32,6 +32,7 @@ import glob
 import tarfile
 import shutil
 import sys
+import tempfile
 import zipfile
 from pathlib import Path
 
@@ -214,14 +215,15 @@ def _extracted_sdist_dir(sdist_path):
 
 
 def _build_and_inject_ac_index(build_dir, extracted_wheel_dir):
-    ac_index_build_name = _build_ac_index(build_dir)
-    extracted_ac_index = os.path.join(extracted_wheel_dir, AC_INDEX_REL_PATH)
-    _remove_file_if_exists(extracted_ac_index)
-    print("Adding auto-complete index into wheel")
-    os.rename(
-        ac_index_build_name,
-        extracted_ac_index,
-    )
+    with tempfile.TemporaryDirectory() as ac_index_dir:
+        ac_index_build_name = _build_ac_index(ac_index_dir)
+        extracted_ac_index = os.path.join(extracted_wheel_dir, AC_INDEX_REL_PATH)
+        _remove_file_if_exists(extracted_ac_index)
+        print("Adding auto-complete index into wheel")
+        shutil.copy2(
+            ac_index_build_name,
+                os.path.join(extracted_wheel_dir, AC_INDEX_REL_PATH),
+            )
 
 
 def _build_ac_index(build_dir, rebuild=True):
