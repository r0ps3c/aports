# Maintainer: Leonardo Arena <rnalrd@alpinelinux.org>
pkgname=multipath-tools
pkgver=0.9.3
pkgrel=2
pkgdesc="Device Mapper Multipathing Driver"
url="http://christophe.varoqui.free.fr/"
arch="all"
license="LGPL-2.0-only"
depends="eudev device-mapper"
makedepends="lvm2-dev libaio-dev readline-dev ncurses-dev eudev-dev
	userspace-rcu-dev json-c-dev perl"
subpackages="$pkgname-doc $pkgname-openrc"
source="$pkgname-$pkgver.tar.gz::https://github.com/opensvc/multipath-tools/archive/refs/tags/$pkgver.tar.gz
	multipath-tools.conf
	multipath.initd
	multipathd.initd
	0001-Disable-Werror-and-O2.patch
	"
options="!check"

build() {
	make prefix="/usr" \
		sysconfdir="/etc" \
		configdir="/etc/multipath/conf.d" \
		mandir="/usr/share/man" \
		infodir="/usr/share/info"
}

package() {
	make prefix="/usr" SYSTEMDPATH="/lib" LIB=lib DESTDIR="$pkgdir" install

	install -D -m644 "$srcdir"/$pkgname.conf \
		"$pkgdir"/etc/multipath.conf
	install -D -m755 "$srcdir"/multipathd.initd \
		"$pkgdir"/etc/init.d/multipathd
	install -D -m755 "$srcdir"/multipath.initd \
		"$pkgdir"/etc/init.d/multipath
	install -D -m644 README.md \
		"$pkgdir"/usr/share/doc/$pkgname/README.md
}

sha512sums="
4faa2ee5a96a9d5d752219931ebc885cb70ed6b022d45ede985ad7919c043a3aee166e6f126d32dffd187c5c32d5cbce91747d87d0b55557e2f7f68b279583da  multipath-tools-0.9.3.tar.gz
e81462b22c0cbc92ea935d7544b9f9a0c4ccbcf13f3bc03dadf6de96407c9cf49964c9bbf02f12a134e1255c66421c6fde39d54b15eef975e8df81bdc88b2213  multipath-tools.conf
97deeee57daee787d807da0a4dbf50baae047ddcda30925f7000ec822b5a17a3dc55196c3e032c8ffbc2caeac690ce5ca485b0a7c99f15e66bddaa000439112a  multipath.initd
71933b27a9ed76d00766ee29e0583ccf08bd689805cf77e284bc318bae62ad7bcde1894b2e50993019462b0c9787eaa780b271244ff11ef52cca290604900343  multipathd.initd
0322dd9c0caf1b43fe3932f57416456d9a12583d0da5c5087540d3d0819771e75277d0f7228ae4643cf48b9e02e032a551428c3a0465cd91ecbd830d89147570  0001-Disable-Werror-and-O2.patch
"
