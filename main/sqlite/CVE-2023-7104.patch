Patch-Source: https://sqlite.org/src/info/0e4e7a05c4204b47
diff --git a/sqlite3.c b/sqlite3.c
index bf9ce16..d295411 100644
--- a/sqlite3.c
+++ b/sqlite3.c
@@ -219190,19 +219190,23 @@ static int sessionReadRecord(
             pIn->iNext += nByte;
           }
         }
       }
       if( eType==SQLITE_INTEGER || eType==SQLITE_FLOAT ){
-        sqlite3_int64 v = sessionGetI64(aVal);
-        if( eType==SQLITE_INTEGER ){
-          sqlite3VdbeMemSetInt64(apOut[i], v);
+        if( (pIn->nData-pIn->iNext)<8 ){
+          rc = SQLITE_CORRUPT_BKPT;
         }else{
-          double d;
-          memcpy(&d, &v, 8);
-          sqlite3VdbeMemSetDouble(apOut[i], d);
-        }
-        pIn->iNext += 8;
+          sqlite3_int64 v = sessionGetI64(aVal);
+          if( eType==SQLITE_INTEGER ){
+            sqlite3VdbeMemSetInt64(apOut[i], v);
+          }else{
+            double d;
+            memcpy(&d, &v, 8);
+            sqlite3VdbeMemSetDouble(apOut[i], d);
+          }
+          pIn->iNext += 8;
+        }
       }
     }
   }
 
   return rc;
