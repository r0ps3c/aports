From 21a962dbb1ec822bef6f209180b21df93debdb63 Mon Sep 17 00:00:00 2001
From: Natanael Copa <ncopa@alpinelinux.org>
Date: Mon, 23 Dec 2024 22:45:13 +0100
Subject: [PATCH 1/2] setup-desktop: add xfce-wayland

Still experimental
---
 setup-desktop.in | 22 +++++++++++++++++++++-
 1 file changed, 21 insertions(+), 1 deletion(-)

diff --git a/setup-desktop.in b/setup-desktop.in
index f4bd263..d6285ba 100644
--- a/setup-desktop.in
+++ b/setup-desktop.in
@@ -38,7 +38,7 @@ fi
 
 de="$1"
 
-valid_desktops="xfce gnome plasma mate sway lxqt none"
+valid_desktops="xfce xfce-wayland gnome plasma mate sway lxqt none"
 if [ $# -eq 1 ] && ! isin "$de" $valid_desktops; then
 	echo "$de is not a valid desktop" >&2
 	usage "1" >&2
@@ -79,6 +79,26 @@ case "$de" in
 			"$@"
 		rc-update add lightdm
 		;;
+	xfce-wayland)
+		setup-wayland-base xfce4 ${BROWSER:-firefox} \
+			elogind \
+			greetd-gtkgreet \
+			gvfs \
+			labwc \
+			polkit-elogind \
+			xfce4-screensaver \
+			xfce4-terminal \
+			"$@"
+		rc-update add dbus
+		rc-update add greetd
+		if ! grep -q ^rc_need "$ROOT"/etc/conf.d/greetd 2>/dev/null; then
+			echo 'rc_need="seatd dbus"' >> "$ROOT"/etc/conf.d/greetd
+		fi
+		if ! grep -q xfce4-wayland "$ROOT"/etc/greetd/environments 2>/dev/null; then
+			echo "xfce4-wayland" >> "$ROOT"/etc/greetd/environments
+		fi
+		addgroup greetd seat
+		;;
 	lxqt)
 		setup-xorg-base ${BROWSER:-firefox} \
 			lxqt-desktop \
-- 
2.47.1

