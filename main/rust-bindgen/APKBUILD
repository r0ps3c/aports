# Contributor: Milan P. StaniÄ‡ <mps@arvanta.net>
# Maintainer: team/rust <alpine@ptrcnull.me>
maintainer="team/rust <alpine@ptrcnull.me>"
pkgname=rust-bindgen
pkgver=0.71.0
pkgrel=0
pkgdesc="automatically generates Rust FFI bindings to C (and some C++) libraries"
url="https://github.com/rust-lang/rust-bindgen"
makedepends="cargo clang cargo-auditable"
checkdepends="bash clang-dev"
arch="all"
license="BSD-3-Clause"
options="net"
source="$pkgname-$pkgver.tar.gz::https://github.com/rust-lang/rust-bindgen/archive/v$pkgver.tar.gz
	disable-test_wrap_static_fns-patch
	"

prepare() {
	default_prepare

	case "$CARCH" in
	a*)
		# possibly https://github.com/rust-lang/rust-bindgen/issues/2777
		patch -Np1 < "$srcdir"/disable-test_wrap_static_fns-patch ;;
	esac

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

check() {
	cargo test --frozen
}

package() {
	install -Dm755 target/release/bindgen "$pkgdir"/usr/bin/bindgen
}

sha512sums="
87213c8c8f362d11cd88a0570b8aaa188e9e51197d9aeb7f9cfbae0a7539f4e1ed40a36c11e15bd9bf5fb78938c571f08b40f250419fe018fdee19733b5eb433  rust-bindgen-0.71.0.tar.gz
1c5578b0935e84f75ebd04f2c4186d835d2e6363f16439ef4ea29c9448d803779ad40cc577b4b1c0f8757d08e7d0013f3a1267ca00410ca39e86e3ad199826a5  disable-test_wrap_static_fns-patch
"
