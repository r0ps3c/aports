# Automatically generated by apkbuild-cpan, template 4
# Contributor: Celeste <cielesti@protonmail.com>
# Maintainer: Celeste <cielesti@protonmail.com>
pkgname=perl-git-raw
pkgver=0.90
pkgrel=0
#_pkgreal is used by apkbuild-cpan to find modules at MetaCpan
_pkgreal=Git-Raw
pkgdesc="Perl bindings to the Git linkable library (libgit2)"
url="https://metacpan.org/release/Git-Raw/"
arch="all"
license="GPL-1.0-or-later OR Artistic-1.0-Perl"
depends="perl"
makedepends="libgit2-dev perl-dev"
checkdepends="perl-capture-tiny perl-file-slurp-tiny perl-test-deep"
subpackages="$pkgname-doc"
source="https://cpan.metacpan.org/authors/id/J/JA/JACQUESG/Git-Raw-$pkgver.tar.gz
	libgit2-shared.mk.pl
	libgit2-version-tests.patch
	libgit2-1.7.1-tests.patch
	libgit2-riscv64-tests.patch
	"
builddir="$srcdir/$_pkgreal-$pkgver"

prepare() {
	default_prepare

	cp -v ../libgit2-shared.mk.pl Makefile.PL
}

build() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	PERL_MM_USE_DEFAULT=1 perl -I. Makefile.PL \
		INSTALLDIRS=vendor \
		NO_PACKLIST=1 \
		NO_PERLLOCAL=1
	make
}

check() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	# setting $HOME may fix the issue on the s390x & x86* package builders
	make test HOME="$srcdir"
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
845c775d62509c48ecdcaf6a692d03916934575d520a85bab1693f73d78416c646d0b442cb68537de778c4ba5df901e43de378792e287588d3b0e79c05ea5fd9  Git-Raw-0.90.tar.gz
6f11abebe591a59dcdf3bb692592221af5e7a812c403cf53d68ee55b90eb3da2e4ebce82baddfe703fc6ee960a5925da85aa556016032f859139fd464759bdb0  libgit2-shared.mk.pl
54334d2758671b62f1852c68b23b2a33ecc76f8127ace636c8cd04c2712c005bc03e075357aa7becbd3a343a342c36ba977a288826c84d69686f5c9e9dd3d341  libgit2-version-tests.patch
b43710476f3e1ee86f382f29a198635ce0e4715840d4b6e79135f5ce3cedd17ef3a3a95adf9609ee324158e698ffa1eff2f3ad23cef2fd46f22bdb2265edcc84  libgit2-1.7.1-tests.patch
1a11cddecaf7991fa7a4a4b37754e22c0e39645e27afc775040b6d9b9f79b1be805b08c1e5642ad1d03ce1566e0efb8d0577041a4b127dfb072ed3afa9a2635f  libgit2-riscv64-tests.patch
"
