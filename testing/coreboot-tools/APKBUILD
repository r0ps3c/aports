# Contributor: Nulo <alpine@nulo.in>
# Maintainer: Adam Thiede <me@adamthiede.com>
pkgname=coreboot-tools
pkgver=4.18
pkgrel=0
pkgdesc="Tools from the coreboot project"
url="https://review.coreboot.org/coreboot"
# coreboot only runs on x86_64 and x86 systems
arch="x86 x86_64"
license="GPL-2.0-only"
subpackages="$pkgname-ectool $pkgname-nvramtool $pkgname-nvramtool-doc:nvramtool_doc:noarch"
source="https://coreboot.org/releases/coreboot-$pkgver.tar.xz"
builddir="$srcdir/coreboot-$pkgver"
options="!check" # no test suite

build() {
	make -e -C util/ectool
	make -e -C util/nvramtool CFLAGS="$CFLAGS -I. -DCMOS_HAL=1"
}

package() {
	make -e -C util/ectool PREFIX="$pkgdir/usr" install
	make -e -C util/nvramtool PREFIX="$pkgdir/usr" install
}

nvramtool() {
	pkgdesc="Manipulates NVRAM from userspace"

	amove usr/sbin/nvramtool
}

nvramtool_doc() {
	pkgdesc="Manipulates NVRAM from userspace (documentation)"
	install_if="$pkgname-nvramtool=$pkgver-r$pkgrel docs"

	amove usr/share/man/man8/nvramtool*
	gzip -9n "$subpkgdir"/usr/share/man/man8/*
}

ectool() {
	pkgdesc="Dumps the RAM of a laptopâ€™s Embedded/Environmental Controller (EC)"

	amove usr/sbin/ectool
}


sha512sums="
b363850d31074950bc710bd0a47a896a6c6ef23c53d720ae90ec2257697a3eeeb211e163199064b5e532e5b1e86cdecf997276d742435deeaaacfb19b83f4e6d  coreboot-4.18.tar.xz
"
