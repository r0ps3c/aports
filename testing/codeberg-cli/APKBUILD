# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
# Maintainer: Matthias Ahouansou <matthias@ahouansou.cz>
pkgname=codeberg-cli
pkgver=0.4.5
pkgrel=0
pkgdesc="CLI Tool for Codeberg similar to gh and glab"
url="https://codeberg.org/RobWalt/codeberg-cli"
arch="all"
license="AGPL-3.0-or-later"
makedepends="
	cargo
	cargo-auditable
	openssl-dev
"
subpackages="
	$pkgname-bash-completion
	$pkgname-fish-completion
	$pkgname-zsh-completion
"
source="$pkgname-$pkgver.tar.gz::https://codeberg.org/RobWalt/codeberg-cli/archive/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname"
options="net !check" # no tests

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

package() {
	install -Dm755 target/release/berg -t "$pkgdir"/usr/bin

	mkdir -p "$pkgdir"/usr/share/bash-completion/completions
	mkdir -p "$pkgdir"/usr/share/fish/vendor_completions.d
	mkdir -p "$pkgdir"/usr/share/zsh/site-functions

	target/release/berg completion bash > "$pkgdir"/usr/share/bash-completion/completions/berg
	target/release/berg completion fish > "$pkgdir"/usr/share/fish/vendor_completions.d/berg.fish
	target/release/berg completion zsh > "$pkgdir"/usr/share/zsh/site-functions/_berg
}

sha512sums="
c99d4f0025027b6c5cd9c0a7fbe9064710ef1df2ba14dd132789b64e7013aa7a420f0c8a01bd2247cc105f6a2ffeed0aaf74be557dc8ea1be68c56a7a6a1dadf  codeberg-cli-0.4.5.tar.gz
"
