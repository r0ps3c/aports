# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
# Maintainer: Matthias Ahouansou <matthias@ahouansou.cz>
pkgname=codeberg-cli
pkgver=0.4.1
pkgrel=0
pkgdesc="CLI Tool for Codeberg similar to gh and glab"
url="https://codeberg.org/RobWalt/codeberg-cli"
# loongarch64: blocked by libc crate
arch="all !loongarch64"
license="AGPL-3.0-or-later"
makedepends="
	cargo
	cargo-auditable
	openssl-dev
"
subpackages="
	$pkgname-bash-completion
	$pkgname-fish-completion
	$pkgname-zsh-completion
"
source="$pkgname-$pkgver.tar.gz::https://codeberg.org/RobWalt/codeberg-cli/archive/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname"
options="net !check" # no tests

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

package() {
	install -Dm755 target/release/berg -t "$pkgdir"/usr/bin

	mkdir -p "$pkgdir"/usr/share/bash-completion/completions
	mkdir -p "$pkgdir"/usr/share/fish/vendor_completions.d
	mkdir -p "$pkgdir"/usr/share/zsh/site-functions

	target/release/berg completion bash > "$pkgdir"/usr/share/bash-completion/completions/berg
	target/release/berg completion fish > "$pkgdir"/usr/share/fish/vendor_completions.d/berg.fish
	target/release/berg completion zsh > "$pkgdir"/usr/share/zsh/site-functions/_berg
}

sha512sums="
6abbdce7ff739912e08a58cff5512109003dbbb30e05a0a3141eceed8efb7a7e38e7ed25d571eaed97f01f0c8a46050e74eee791c6448c97a9065bbd5eceb658  codeberg-cli-0.4.1.tar.gz
"
