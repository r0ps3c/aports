Patch-Source: https://gitlab.gnome.org/guidog/xdg-desktop-portal-phosh/-/merge_requests/4
---
From 58083270e3724b6c9ca3fa5eea7750f3c7281762 Mon Sep 17 00:00:00 2001
From: fossdd <fossdd@pwned.life>
Date: Wed, 16 Oct 2024 22:42:19 +0200
Subject: [PATCH] data: Only install systemd unit with systemd feature option

---
 data/meson.build  | 25 ++++++++++++++-----------
 meson_options.txt |  2 ++
 2 files changed, 16 insertions(+), 11 deletions(-)
 create mode 100644 meson_options.txt

diff --git a/data/meson.build b/data/meson.build
index 43ea513..49702fa 100644
--- a/data/meson.build
+++ b/data/meson.build
@@ -31,18 +31,21 @@ i18n.merge_file(
 )
 
 # Systemd user unit
-systemd = dependency('systemd', version: '>= 242')
-systemduserunitdir = systemd.get_variable(
-  pkgconfig: 'systemduserunitdir',
-  pkgconfig_define: ['prefix', get_option('prefix')]
-)
+systemd = dependency('systemd', version: '>= 242',
+                     required : get_option('systemd'))
+if systemd.found()
+  systemduserunitdir = systemd.get_variable(
+    pkgconfig: 'systemduserunitdir',
+    pkgconfig_define: ['prefix', get_option('prefix')]
+  )
 
-configure_file(
-  input: '@0@.service.in'.format(pmp_exe_name),
-  output: '@0@.service'.format(pmp_exe_name),
-  configuration: data_conf,
-  install_dir: systemduserunitdir,
-)
+  configure_file(
+    input: '@0@.service.in'.format(pmp_exe_name),
+    output: '@0@.service'.format(pmp_exe_name),
+    configuration: data_conf,
+    install_dir: systemduserunitdir,
+  )
+endif
 
 # Portal conf
 # Phosh ships a phosh.portal for the Access portal
diff --git a/meson_options.txt b/meson_options.txt
new file mode 100644
index 0000000..a791da1
--- /dev/null
+++ b/meson_options.txt
@@ -0,0 +1,2 @@
+option('systemd', type : 'feature', value : 'auto',
+       description : 'Include systemd user units')
-- 
GitLab

