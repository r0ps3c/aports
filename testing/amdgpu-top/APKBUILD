# Maintainer: psykose <alice@ayaya.dev>
pkgname=amdgpu-top
pkgver=0.1.11
pkgrel=0
pkgdesc="Tool to display AMDGPU usage"
url="https://github.com/Umio-Yasuno/amdgpu_top"
# only useful with amd gpus
arch="x86_64 aarch64 ppc64le"
license="MIT"
makedepends="
	cargo
	libdrm-dev
	wayland-dev
	"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/Umio-Yasuno/amdgpu_top/archive/refs/tags/v$pkgver.tar.gz"
builddir="$srcdir/amdgpu_top-$pkgver"
options="!check net" # no tests

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo build --frozen --release --bins
}

package() {
	install -Dm755 target/release/amdgpu_top \
		-t "$pkgdir"/usr/bin/
	install -Dm644 docs/amdgpu_top.1 \
		-t "$pkgdir"/usr/share/man/man1/
	install -Dm644 assets/*.desktop \
		-t "$pkgdir"/usr/share/applications/
}

sha512sums="
eda288c82c34e80f002b34ac472ba70ce38f6e467c82fe59c75619fe6039ab73b43cf6ae3953c6e40524244049eb149fc8125d44810892203abce033bf5513a9  amdgpu-top-0.1.11.tar.gz
"
