# Automatically generated by apkbuild-cpan, template 4
# Contributor: Celeste <cielesti@protonmail.com>
# Maintainer: Celeste <cielesti@protonmail.com>
pkgname=perl-net-jabber
#_pkgreal is used by apkbuild-cpan to find modules at MetaCpan
_pkgreal=Net-Jabber
pkgver=2.0
pkgrel=0
pkgdesc="Access the Jabber protocol with Perl"
url="https://metacpan.org/release/Net-Jabber/"
arch="noarch"
license="LGPL-2.0-or-later"
depends="perl perl-net-xmpp"
subpackages="$pkgname-doc"
source="https://cpan.metacpan.org/authors/id/R/RE/REATMON/Net-Jabber-$pkgver.tar.gz
	builtin-digest-sha.patch
	hash-randomization.patch
	"
builddir="$srcdir/$_pkgreal-$pkgver"

prepare() {
	default_prepare

	# bundled Test::More causes deprecation warnings
	mv -v t/lib t/lib.old
}

build() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	PERL_MM_USE_DEFAULT=1 perl -I. Makefile.PL \
		INSTALLDIRS=vendor \
		NO_PACKLIST=1 \
		NO_PERLLOCAL=1
	make
}

check() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	make test
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
2ad275fdef8a7ed17dc464f692b974e71bc3a5df5239943cceaec9509e6454945023e220ddfb42763e18813124f6b7f2d6d43faf3059e0680b753486961a1b4c  Net-Jabber-2.0.tar.gz
d418222fbb510329c1e74c934e171f13f8a23bd1c8ee0526f36ea42de3e2eae8814b04bebe0d0ddf99ac351812b16ed593fb860e17191849cb557359d3981df7  builtin-digest-sha.patch
c9e816e4156b2b3890c8f02ac07e59f3bac0bdd56f0834694ec33afdfd1e02a20242828c2f241ef155353170c745fa2e145ebf953f246e25d62c4ea10db30260  hash-randomization.patch
"
