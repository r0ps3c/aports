maintainer="Thomas BÃ¶hler <witcher@wiredspace.de>"
pkgname=cocogitto
pkgver=6.2.0
pkgrel=2
pkgdesc="The Conventional Commits toolbox"
url="https://docs.cocogitto.io/"
arch="all"
license="MIT"
makedepends="
	cargo
	cargo-auditable
	libgit2-dev
	"
subpackages="
	$pkgname-doc
	$pkgname-bash-completion
	$pkgname-fish-completion
	$pkgname-zsh-completion
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/cocogitto/cocogitto/archive/refs/tags/$pkgver.tar.gz
	001-bump-libgit2.patch
	002-bump-libc.patch
	"
options="net !check" # tests relies on, among other things, specific tags

export LIBGIT2_NO_VENDOR=1  # use system libgit2

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --frozen --release

	local compgen="target/release/cog generate-completions"

	$compgen bash > cog.bash
	$compgen fish > cog.fish
	$compgen zsh > cog.zsh

	mkdir man
	target/release/cog generate-manpages man
}

package() {
	install -Dm755 -t "$pkgdir"/usr/bin target/release/cog

	install -Dm644 -t "$pkgdir"/usr/share/doc/"$pkgname" CHANGELOG.md
	install -Dm644 -t "$pkgdir"/usr/share/doc/"$pkgname" README.md

	install -Dm644 -t "$pkgdir"/usr/share/licenses/"$pkgname" LICENSE

	install -Dm644 -t "$pkgdir"/usr/share/man/man1 man/*.1

	install -Dm644 cog.bash \
		"$pkgdir"/usr/share/bash-completion/completions/cog
	install -Dm644 cog.fish \
		"$pkgdir"/usr/share/fish/vendor_completions.d/cog.fish
	install -Dm644 cog.bash \
		"$pkgdir"/usr/share/zsh/site-functions/_cog
}

sha512sums="
98d6485e74e1e4664e353b29e165a22505207c8ce2fc1467ffe988ed9475349adc9c638f245ce1881c322a87158e39daef17bf0d350424dc444cabd700b4a39f  cocogitto-6.2.0.tar.gz
6d10dd59124422cb150ce6633add50b0067df161905725f1e4393b8ecf4d6f55c41bde9c682e3c551160c3f8526787a877aa69c07f59a8766165327978a1b0fc  001-bump-libgit2.patch
d1ef6b3e11e845874318c24d8e281ed6526a0dbf1ad688f483d639867dbb0b56843d9b2d62271ad8efa5605fb12864498c57e425dc313fc5cbee84bea53db407  002-bump-libc.patch
"
