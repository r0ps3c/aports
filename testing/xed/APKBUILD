# Maintainer: psykose <alice@ayaya.dev>
pkgname=xed
pkgver=3.4.0
pkgrel=0
pkgdesc="X-Apps Text Editor"
url="https://github.com/linuxmint/xed"
arch="all"
license="GPL-2.0-or-later"
makedepends="
	intltool
	itstool
	libpeas-dev
	gobject-introspection-dev
	gspell-dev
	gtksourceview4-dev
	gvfs-dev
	gzip
	meson
	python3
	xapp-dev
	"
checkdepends="cage-run"
subpackages="$pkgname-lang $pkgname-dev $pkgname-doc $pkgname-python"
source="$pkgname-$pkgver.tar.gz::https://github.com/linuxmint/xed/archive/refs/tags/$pkgver.tar.gz"
options="!check" # needs dogtail

build() {
	abuild-meson \
		-Db_lto=true \
		. output
	meson compile -C output
}

check() {
	cage-run meson test --no-rebuild --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

python() {
	depends="$pkgname=$pkgver-r$pkgrel libpeas-python3"
	pkgdesc="$pkgdesc (python plugins)"
	amove \
		usr/lib/xed/plugins/joinlines* \
		usr/lib/xed/plugins/open-uri-context-menu* \
		usr/lib/xed/plugins/textsize*
}

sha512sums="
6468d1f2f5010b2a975b87495af95f5f7960497ab40cdd3b5e42e61939f4c1000b9947235b0ac017572627afb60a2fb22f3af88af30a0e8273f2f553e7395eaa  xed-3.4.0.tar.gz
"
