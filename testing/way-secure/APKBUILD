maintainer="Hugo Osvaldo Barrera <hugo@whynothugo.nl>"
pkgname=way-secure
pkgver=0.1.0
pkgrel=0
pkgdesc="Create wayland security contexts"
url="https://git.sr.ht/~whynothugo/way-secure"
# s390x: nix/libc crate
# loongarch64: libc crate
arch="all !s390x !loongarch64"
license="ISC"
makedepends="cargo cargo-auditable scdoc"
subpackages="$pkgname-doc"
source="way-secure-$pkgver.tar.gz::https://git.sr.ht/~whynothugo/way-secure/archive/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname-v$pkgver"
options="net" # fetch dependencies

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
	scdoc < way-secure.1.scd > way-secure.1
}

check() {
	cargo test --frozen
}

package() {
	install -Dm 0755 target/release/way-secure -t "$pkgdir"/usr/bin/
	install -Dm 0644 way-secure.1 -t "$pkgdir"/usr/share/man/man1/
}

sha512sums="
4bd4b6157209dab69294c83108c5495fe07ff672ca544fb846d8bf2eb424fe08d399b9472ef5040f49b74fafb9f1b36205944463533f26ba15ac7076ec70cd4b  way-secure-0.1.0.tar.gz
"
