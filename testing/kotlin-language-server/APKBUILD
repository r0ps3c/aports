# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
# Maintainer: Matthias Ahouansou <matthias@ahouansou.cz>
pkgname=kotlin-language-server
pkgver=1.3.5
pkgrel=0
pkgdesc="Kotlin code completion, linting and more for any editor/IDE using the Language Server Protocol"
url="https://github.com/fwcd/kotlin-language-server"
arch="x86_64" # blocked by openjdk11, rest don't build, time out, or fail to build tests
license="MIT"
checkdepends="maven"
depends="openjdk11"
source="$pkgname-$pkgver.tar.gz::https://github.com/fwcd/kotlin-language-server/archive/refs/tags/$pkgver.tar.gz"
options="!archcheck"

build() {
	./gradlew :server:installDist
}

check() {
	./gradlew :server:test
}

package() {
	mkdir -p "$pkgdir"/usr/share/kotlin "$pkgdir"/usr/bin
	cp -r server/build/install/server "$pkgdir"/usr/share/kotlin/kotlin-language-server
	ln -sf "$pkgdir"/usr/share/kotlin/kotlin-language-server/bin/kotlin-language-server "$pkgdir"/usr/bin/kotlin-language-server
}

sha512sums="
b23f759a2a6f203086786e6e0271c48b23599454a895047451b6f1c6fe3534c9a77f1c07a315c85cb44fb7b777df2e1a22bada7e0a91a708e71a9444def97da4  kotlin-language-server-1.3.5.tar.gz
"
