# Maintainer: Marian Buschsieweke <marian.buschsieweke@posteo.net>
pkgname=theforceengine
pkgver=1.09.410
pkgrel=0
pkgdesc="Modern rebuild of the Jedi Engine (needs purchased copy of game data files to run)"
arch="all"
url="https://theforceengine.github.io/"
license="GPL-2.0-only"
makedepends="$depends_dev
	cmake
	devil-dev
	devil
	glew-dev
	libunwind-dev
	rtaudio-dev<6.0.0
	rtmidi-dev
	samurai
	sdl2-dev
	"
source="
	theforceengine-$pkgver.tar.gz::https://github.com/luciusDXL/TheForceEngine/archive/refs/tags/v$pkgver.tar.gz

	backtrace.patch
	format_security_no_literal.patch
	path_max.patch
	compilation_32bit_systems.patch
	"
subpackages="$pkgname-doc"
options="!check" # no unit tests provided
builddir="$srcdir/TheForceEngine-$pkgver"

build() {
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=RelWithDebInfo \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib
	cmake --build build
}

doc() {
	default_doc

	amove usr/share/TheForceEngine/Documentation
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
fa474401d6864dd5f626653be417d739891b648f636268cf9604853c00b418c8d4dca455e1729206694a843ff0160ca0e9fe49a34cc881e2dda7dd90d33313b4  theforceengine-1.09.410.tar.gz
6bff94570ec327556b78dd1f967f00ff85c06325f5a017624a33c7b02a03dbf595b6921e7cb164f6556a485dfa5f269617d61213bde84056859c9719ef8c093c  backtrace.patch
eb109e4aea473cddf22579d8b56a1f20cbdfa4b3210fb721b715356929a6f7e9b6ebb488ee8d0032f0d54568898511de333d302510fc49e04cb8c6a52c0d3308  format_security_no_literal.patch
d9b59854aa191fd18ff9b9a39f6f7ea1472cc60eb340ef86ef721f9f88a93fe2359eb0ed3b3253c2b44b6f28a2f5bd7bfaef6ec13ad287cadf0cf013ee5042c9  path_max.patch
b5487f619da23f75babf735f42edfc58611791094135f1dca83c37aca30b6ab0bb138887a38f337237981cba8402e0bacc6a54315700fb9a3b36dae608ed5da3  compilation_32bit_systems.patch
"
