# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
# Maintainer: Matthias Ahouansou <matthias@ahouansou.cz>
pkgname=listenbrainz-mpd
pkgver=2.3.3
pkgrel=0
pkgdesc="ListenBrainz submission client for MPD written in Rust"
url="https://codeberg.org/elomatreb/listenbrainz-mpd"
arch="all"
license="AGPL-3.0-only"
makedepends="
	cargo
	cargo-auditable
	openssl-dev
	sqlite-dev
"
subpackages="
	$pkgname-doc
	$pkgname-bash-completion
	$pkgname-zsh-completion
	$pkgname-fish-completion
"
source="$pkgname-$pkgver.tar.gz::https://codeberg.org/elomatreb/listenbrainz-mpd/archive/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname"
options="net !check" # no tests

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen --all-features
}

package() {
	install -Dm755 target/release/listenbrainz-mpd "$pkgdir"/usr/bin/listenbrainz-mpd

	install -Dm644 listenbrainz-mpd.adoc -t "$pkgdir"/usr/share/doc/$pkgname/
	install -Dm644 LICENSE.txt "$pkgdir"/usr/share/licenses/$pkgname/LICENSE

	install -Dm644 generated_completions/listenbrainz-mpd.bash "$pkgdir"/usr/share/bash-completion/completions/listenbrainz-mpd
	install -Dm644 generated_completions/listenbrainz-mpd.fish "$pkgdir"/usr/share/fish/vendor_completions.d/listenbrainz-mpd.fish
	install -Dm644 generated_completions/_listenbrainz-mpd "$pkgdir"/usr/share/zsh/site-functions/_listenbrainz-mpd
}

sha512sums="
1955ab021d31384891549040ffcb299d449dbb92ee7ef795390a890a554be87e41b0ae70035abf3cc141999b5a0e96f5a9162a6f4a22387d35458ba29e48ffad  listenbrainz-mpd-2.3.3.tar.gz
"
