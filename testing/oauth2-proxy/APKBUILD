# Contributor: Lauren N. Liberda <lauren@selfisekai.rocks>
# Maintainer: Lauren N. Liberda <lauren@selfisekai.rocks>
pkgname=oauth2-proxy
pkgver=7.4.0_git20221103
_commit=86011e8ac7e41b522a17ae191bbb2a55b5f3eba3
pkgrel=1
pkgdesc="Reverse proxy that provides authentication with Google, Azure, OpenID Connect and many more identity providers"
url="https://oauth2-proxy.github.io/oauth2-proxy"
arch="all"
license="MIT"
install="$pkgname.pre-install"
makedepends="go"
subpackages="$pkgname-openrc"
source="
	https://github.com/oauth2-proxy/oauth2-proxy/archive/$_commit/oauth2-proxy-$_commit.tar.gz

	oauth2-proxy.initd
	oauth2-proxy.confd
	"
options="net"
builddir="$srcdir/oauth2-proxy-$_commit"

build() {
	VERSION="$pkgver" make oauth2-proxy
}

check() {
	go test ./...
}

package() {
	install -Dm755 oauth2-proxy "$pkgdir"/usr/bin/oauth2-proxy
	install -Dm755 "$srcdir"/oauth2-proxy.initd "$pkgdir"/etc/init.d/oauth2-proxy
	install -Dm755 "$srcdir"/oauth2-proxy.confd "$pkgdir"/etc/conf.d/oauth2-proxy
	install -Dm644 contrib/oauth2-proxy.cfg.example "$pkgdir"/etc/oauth2-proxy/oauth2-proxy.cfg
}

sha512sums="
9927bafe728bcf6b653ae4e7df3d0da6df3432915e61655006b3fb10c79830d2bed578345d478dd07bafcb97b2e20997588342fe30305bc8defbdd37666be058  oauth2-proxy-86011e8ac7e41b522a17ae191bbb2a55b5f3eba3.tar.gz
4f91d8bff4ced7fca4d0795c2a0a89e0c8cb28f981db435f30b30f122757b8fe9d855a0d4d87497becedc543cdf48d20f3bc7813728bffaeac891d927157a237  oauth2-proxy.initd
56ec244414ecc96cad80b7c3f231c9e437350046ec80edc3661753bf24e194c51472acf2b097d893f3aed4200b0304e20e9c4d6edd05d698ff54524137c726e7  oauth2-proxy.confd
"
