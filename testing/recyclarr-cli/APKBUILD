# Contributor: Fabricio Silva <hi@fabricio.dev>
# Maintainer: Fabricio Silva <hi@fabricio.dev>
pkgname=recyclarr-cli
pkgver=7.2.0
pkgrel=0
pkgdesc="Automatically sync TRaSH guides to your Sonarr and Radarr instances"
url="https://github.com/recyclarr/recyclarr"
arch="x86_64 aarch64 armv7"
license="MIT"
options="net !check !strip" # strip breaks the package
depends="dotnet8-runtime git"
makedepends="dotnet8-sdk"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/recyclarr/recyclarr/archive/refs/tags/v$pkgver.tar.gz
	0001-disable-gitversion.patch
	"
builddir="$srcdir/recyclarr-$pkgver"

prepare() {
	default_prepare

	# apply patch version
	local _ver="$pkgver-r$pkgrel.alpine"
	(
		cd src/Recyclarr.Cli
		sed -i "s/{Version}/$_ver/" Program.cs
		sed -i "s/{Version}/$_ver/" Console/Setup/ProgramInformationDisplayTask.cs
	)
}

build() {
	dotnet publish src/Recyclarr.Cli \
		--no-self-contained \
		--use-current-runtime \
		--configuration Release \
		--output publish \
		-p:PublishSingleFile=true \
		-p:DisableGitVersionTask=true
}

package() {
	install -Dm755 publish/recyclarr -t "$pkgdir"/usr/bin
}

sha512sums="
27aded1e7f410ade6e70d03717726bdb888c56f04474d0ef84a6aa9d1301a17f82a80d91aa115a8ca6990ea6f29aef8f937f065c2f770938b409a78afeb18a48  recyclarr-cli-7.2.0.tar.gz
ed44885591a7edd446a673bc5ce79fb41dba9d3ffb56167dd2c1e3c0dc739f004c7af39caa940f7a5eb14191fd1e025b0a0b6892371ddcbe9844a38328c4487c  0001-disable-gitversion.patch
"
