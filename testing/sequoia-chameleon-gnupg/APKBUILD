# Maintainer: psykose <alice@ayaya.dev>
pkgname=sequoia-chameleon-gnupg
pkgver=0.3.1
pkgrel=0
pkgdesc="Sequoia's reimplementation of the GnuPG interface"
url="https://sequoia-pgp.org/"
# ring
arch="all !ppc64le !s390x !riscv64"
license="GPL-3.0-or-later"
makedepends="
	bzip2-dev
	cargo
	cargo-auditable
	clang15-dev
	nettle-dev
	openssl-dev
	sqlite-dev
	"
source="https://gitlab.com/sequoia-pgp/sequoia-chameleon-gnupg/-/archive/v$pkgver/sequoia-chameleon-gnupg-v$pkgver.tar.gz
	getrandom.patch
	"
builddir="$srcdir/$pkgname-v$pkgver"
options="net !check" # bunch of failures against gpg cli

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

check() {
	cargo test --frozen
}

package() {
	install -Dm755 target/release/gpgv-sq target/release/gpg-sq \
		-t "$pkgdir"/usr/bin
}

sha512sums="
d60d50aab58676d936ef1747a77906d14687b57fbe5be20f0aac15d9e818e9ca53809e556d3adaf5b98018d457bf67a398e9eeec7282c7cd4e7914fc7ae9fff2  sequoia-chameleon-gnupg-v0.3.1.tar.gz
081e207d336b8581d39d729c8c241825c01d65725644664037f91f74dcb1997d6f83b5ace4f50fb4bf5cc178b464c26bb780a2a07672e930969b65b997ec58fd  getrandom.patch
"
