# Maintainer: psykose <alice@ayaya.dev>
pkgname=libclc
# follow llvm versioning
pkgver=16.0.3
pkgrel=0
_llvmver=${pkgver%%.*}
pkgdesc="Open source implementation of the library requirements of the OpenCL C programming language"
url="https://libclc.llvm.org/"
arch="all"
license="Apache-2.0 WITH LLVM-exception"
depends_dev="$pkgname=$pkgver-r$pkgrel"
makedepends="
	clang-dev
	cmake
	llvm$_llvmver-dev
	llvm$_llvmver-static
	samurai
	spirv-llvm-translator-dev
	"
checkdepends="llvm-test-utils"
subpackages="$pkgname-dev"
source="https://github.com/llvm/llvm-project/releases/download/llvmorg-$pkgver/libclc-$pkgver.src.tar.xz
	https://github.com/llvm/llvm-project/releases/download/llvmorg-$pkgver/cmake-$pkgver.src.tar.xz
	"
builddir="$srcdir/libclc-$pkgver.src"
options="!check" # todo: they fail for some reason

build() {
	CC=clang \
	CXX=clang++ \
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DLLVM_SPIRV=/usr/bin/llvm-spirv \
		-DCMAKE_MODULE_PATH="$srcdir/cmake-$pkgver.src/Modules"
	cmake --build build
}

check() {
	cmake --build build --target test
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
e15018a43d5d65c56c64ecf7f1d6a99b9b1a08d756d9ad8d980223948eab117da8d1d2f5066d575179364fdfa76c22bf38c1ebac0c93f123fb8b29c46ce2c00b  libclc-16.0.3.src.tar.xz
01dd624f5276910760f15062f1f3abf68c6ab66c02a4b683ee739663d3f67c47420d8ce47d79e47144edc6bfcc390ffe37bd01d787186607421e3be7288c8569  cmake-16.0.3.src.tar.xz
"
