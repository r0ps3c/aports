# Maintainer: psykose <alice@ayaya.dev>
pkgname=libjodycode
pkgver=1.3
pkgrel=1
pkgdesc="Shared code used by several utilities written by Jody Bruchon"
url="https://github.com/jbruchon/libjodycode"
arch="all"
license="MIT"
subpackages="$pkgname-dev $pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/jbruchon/libjodycode/archive/refs/tags/v$pkgver.tar.gz
	fix-ver-1.patch
	fix-ver-2.patch
	"
options="!check" # no tests

build() {
	export NO_SIMD=1
	export NO_SSE2=1
	export NO_AVX2=1
	export CFLAGS="$CFLAGS -DNO_SSE2"
	make CFLAGS="$CFLAGS -flto=auto"
}

package() {
	make DESTDIR="$pkgdir" PREFIX=/usr install
	rm -v "$pkgdir"/usr/lib/*.a
}

sha512sums="
3fce51b96e0e386ab29ff358d058056814326892e13e50c6a16c80b590636655c74858e0771dbfe23a671eda4b42575732a80a4c0c14c6cffc3bc53914a6609e  libjodycode-1.3.tar.gz
e1837723d313ac04cfa9971fad4c1ccb5a4bc96338b7e4f6cf6fac7964de433cccc912fc4b30451f92964d0714fdf5e0ccf81837b90e4bb9a54bcc6493549b6a  fix-ver-1.patch
3a7968e77d45e71eb98bb6f668ba4dc982306e915fcb1ae0027e9b963de2624c0f791586fc61fd8f4332a3061c92f13d338335df90d39a2ffe4b689fac0f2a95  fix-ver-2.patch
"
