# Contributor: Ian Bashford <ianbashford@gmail.com>
# Maintainer: Ian Bashford <ianbashford@gmail.com>
pkgname=doggo
pkgver=0.5.6
pkgrel=1
pkgdesc="A modern command-line DNS client, additionally supporting DoH, DoT and DNSCrypt protocols"
url="https://github.com/mr-karan/doggo"
arch="all"
license="GPL-3.0-only"
makedepends="go"
source="$pkgname-$pkgver.tar.gz::https://github.com/mr-karan/doggo/archive/v$pkgver.tar.gz"
options="net !check" # no test suite

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

prepare() {
	default_prepare

	# Fix build with Go 1.21.
	# See https://github.com/mr-karan/doggo/commit/9818c32b9db5b4db7d560dfeaa530a1e7bbbcc0e
	go mod edit -replace github.com/quic-go/quic-go=github.com/quic-go/quic-go@v0.37.4
	go mod tidy
}

build() {
	make CLI_BIN="./doggo" VERSION=$pkgver build-cli
}

package() {
	install -m755 -D $pkgname "$pkgdir"/usr/bin/$pkgname
}

sha512sums="
4f4b43925896da024d60d600f17d7377ca1550cb3b920a14aeca0717c4e7974ac71a841db87c9f6ffbda50e4ae25fdac377c9ffd942b16b584db2ab6fff21c5d  doggo-0.5.6.tar.gz
"
