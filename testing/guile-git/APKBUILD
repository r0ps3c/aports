# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Maintainer: Sören Tempel <soeren+alpine@soeren-tempel.net>
pkgname=guile-git
pkgver=0.5.2
pkgrel=0
pkgdesc="Guile bindings of libgit2"
url="https://gitlab.com/guile-git/guile-git"
arch="all"
license="GPL-3.0-or-later"
depends="guile guile-bytestructures libgit2-dev"
makedepends="autoconf automake guile-dev zlib-dev texinfo"
checkdepends="openssh-server openssh-client"
subpackages="$pkgname-doc"
options="!strip" # https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=907061
source="https://gitlab.com/guile-git/guile-git/-/archive/v$pkgver/guile-git-v$pkgver.tar.bz2
	libgit2-compat.patch
	skip-ssh-tests.patch"
builddir="$srcdir/$pkgname-v$pkgver"

prepare() {
	default_prepare
	autoreconf -vfi
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
905e03323a65bd057a50fc75265446407b9b6263852d3fa947a261d66b00ded2965bdb883ec8585c4748a28a1e0ce762a41511004a69fd1b1649c4146703278c  guile-git-v0.5.2.tar.bz2
ccb630bfcebecf1bec8170d912d5c4df82e4c9a87d4fc3bd1d02b0b282ddefc703532cfa7dbe3d37f0f62bcc5d40ac3253c3cdc08acf0178fa68a2bd7b74ce01  libgit2-compat.patch
c06974da410781544afc108689c310c1ce2230da369f2fa03b5c5c49ca3f04ac456db0c3462cebac9324ad8d88a761f36e50c35a44c104f91fe495fc4dbd783e  skip-ssh-tests.patch
"
