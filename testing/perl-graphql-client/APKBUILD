# Automatically generated by apkbuild-cpan, template 4
# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=perl-graphql-client
#_pkgreal is used by apkbuild-cpan to find modules at MetaCpan
_pkgreal=GraphQL-Client
pkgver=0.605
pkgrel=0
pkgdesc="Execute GraphQL queries and mutations"
url="https://metacpan.org/release/GraphQL-Client/"
arch="noarch"
license="GPL-1.0-or-later OR Artistic-1.0-Perl"
depends="perl perl-http-anyua perl-json-maybexs perl-namespace-clean"
checkdepends="perl-future perl-test-deep perl-test-exception"
subpackages="$pkgname-cli $pkgname-doc"
source="https://cpan.metacpan.org/authors/id/C/CC/CCM/GraphQL-Client-$pkgver.tar.gz"
builddir="$srcdir/$_pkgreal-$pkgver"

build() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	PERL_MM_USE_DEFAULT=1 perl -I. Makefile.PL \
		INSTALLDIRS=vendor \
		NO_PACKLIST=1 \
		NO_PERLLOCAL=1
	make
}

check() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	make test
}

package() {
	make DESTDIR="$pkgdir" install
}

cli() {
	pkgdesc="$pkgdesc (command-line program)"
	depends="
		$pkgname=$pkgver-r$pkgrel
		perl-json-path
		perl-text-csv
		perl-text-table-any
		perl-yaml
		"

	amove usr/bin/graphql
	amove usr/share/perl5/vendor_perl/GraphQL/Client/CLI.pm
}

sha512sums="
c22b0afe26de013bca679a715359f0a6d3b40bd0e5b21cad95d25c50d785369ab309f380241438639472aa4e23ade45e2306ee507ac6ae2fbb068da9186ceba9  GraphQL-Client-0.605.tar.gz
"
