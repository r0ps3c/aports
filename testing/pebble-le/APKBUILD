# Maintainer: leso-kn <info@lesosoftware.com>
pkgname=pebble-le
pkgver=0.2.2
pkgrel=0
_bluez_inc="41bdc1a5d98d929764600c14d0654c9ff5112f86"
pkgdesc="Library to talk to Pebble Smartwatches via Bluetooth Low Energy (BLE)"
url="https://github.com/leso-kn/pebble-le"
arch="all"
license="MIT"
makedepends="
	boost-dev
	cmake
	fmt-dev
	dbus-dev
	glib-dev
	samurai
	simpleble-dev
	"
install="$pkgname.pre-install"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/leso-kn/pebble-le/archive/refs/tags/v$pkgver.tar.gz
	bluez_inc-$_bluez_inc.tar.gz::https://github.com/weliem/bluez_inc/archive/$_bluez_inc.tar.gz
	simpleble.patch
	"
options="!check" # soon pebble-le unit-tests

prepare() {
	rmdir third_party/binc third_party/SimpleBLE

	mv "$srcdir"/bluez_inc-$_bluez_inc third_party/binc
	default_prepare
}

build() {
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_INSTALL_INCLUDEDIR=/usr/include \
		-DCMAKE_INSTALL_SYSCONFDIR=/etc \
		-DCMAKE_SKIP_INSTALL_RPATH=ON
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
67442f2efd9e9ed3db983337fe5252276d2e1d61979c7f4b56ad93cab4154d3ca2e9b0d22b2475f1a70f1cc009f5d3aafe9d2431870d25bc1881e8c1b79a6eb3  pebble-le-0.2.2.tar.gz
2321fb7cdddbde7208c92185bc5af9083fc313b8ae2433308423b6ce5c1895b19bf27671ca6f352bd10a62b7ed830586d973268bc8ab547943180d64fdc72081  bluez_inc-41bdc1a5d98d929764600c14d0654c9ff5112f86.tar.gz
77f49061da9dfef1e1765df2dcf5633a0d1ea95ced4e7276a5abee98b98108ec0dc53d4e3e27d58abb1f280afccc53f6724d5957e898d13f69c05470d84a8580  simpleble.patch
"
